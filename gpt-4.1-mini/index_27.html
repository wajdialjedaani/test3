<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Accessible Interactive To-Do List with Priorities and Due Dates</title>
<style>
  /* Reset and base */
  *, *::before, *::after {
    box-sizing: border-box;
  }
  html {
    font-size: 100%;
    scroll-behavior: smooth;
  }
  body {
    margin: 0;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    background: linear-gradient(135deg, #4a90e2 0%, #50e3c2 100%);
    color: #111;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  a:focus, button:focus, input:focus, select:focus, textarea:focus {
    outline: 3px solid #ffbf47;
    outline-offset: 2px;
  }
  /* Skip link */
  .skip-link {
    position: absolute;
    top: -40px;
    left: 1rem;
    background: #ffbf47;
    color: #111;
    padding: 0.5rem 1rem;
    z-index: 100;
    border-radius: 0.25rem;
    font-weight: 700;
    text-decoration: none;
    transition: top 0.3s ease;
  }
  .skip-link:focus {
    top: 1rem;
  }
  /* Layout */
  header, nav, main, footer {
    padding-left: 1rem;
    padding-right: 1rem;
  }
  header {
    background-color: #003366;
    color: #fff;
    padding: 1.5rem 1rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
  }
  header h1 {
    margin: 0;
    font-size: 2rem;
    max-width: 80ch;
  }
  nav {
    background-color: #00509e;
    box-shadow: inset 0 -3px 5px rgba(0,0,0,0.2);
  }
  nav ul {
    margin: 0;
    padding: 0.5rem 0;
    list-style: none;
    display: flex;
    gap: 1rem;
    max-width: 80ch;
  }
  nav a {
    color: #ffbf47;
    text-decoration: none;
    font-weight: 700;
    padding: 0.5rem 0.75rem;
    border-radius: 0.3rem;
    display: inline-block;
    min-width: 44px;
    min-height: 44px;
    line-height: 1.3;
  }
  nav a:hover,
  nav a:focus {
    background-color: #ffbf47;
    color: #003366;
    outline-offset: 0;
  }
  main {
    flex-grow: 1;
    max-width: 80ch;
    margin: 2rem auto;
    background: #ffffffee;
    border-radius: 0.5rem;
    padding: 2rem 2rem 3rem 2rem;
    box-shadow: 0 8px 16px rgba(0,0,0,0.15);
  }
  main h2 {
    font-size: 1.75rem;
    margin-top: 0;
    margin-bottom: 1rem;
    color: #003366;
  }
  /* Form styling */
  form {
    display: grid;
    grid-template-columns: 1fr 1fr auto;
    gap: 1rem 1.5rem;
    align-items: end;
    margin-bottom: 2rem;
  }
  fieldset {
    border: none;
    padding: 0;
    margin: 0;
  }
  legend {
    font-weight: 700;
    margin-bottom: 0.5rem;
    font-size: 1.125rem;
    color: #003366;
  }
  label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.25rem;
    color: #003366;
  }
  input[type="text"],
  input[type="date"],
  select {
    font-size: 1rem;
    padding: 0.5rem 0.75rem;
    border: 2px solid #003366;
    border-radius: 0.375rem;
    width: 100%;
    max-width: 100%;
    color: #111;
    background-color: #fff;
    transition: border-color 0.3s ease;
  }
  input[type="text"]:focus,
  input[type="date"]:focus,
  select:focus {
    border-color: #ffbf47;
    outline: none;
  }
  /* Required field indicator */
  .required-indicator {
    color: #d00000;
    margin-left: 0.25rem;
  }
  /* Error messages */
  .error-message {
    color: #d00000;
    font-size: 0.875rem;
    margin-top: 0.25rem;
  }
  /* Button styling */
  button[type="submit"],
  button.delete-task,
  button.toggle-complete {
    background: linear-gradient(135deg, #ffbf47 0%, #ff9f00 100%);
    border: none;
    color: #003366;
    font-weight: 700;
    font-size: 1rem;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    cursor: pointer;
    min-width: 44px;
    min-height: 44px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 6px rgba(255,191,71,0.6);
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  button[type="submit"]:hover,
  button[type="submit"]:focus,
  button.delete-task:hover,
  button.delete-task:focus,
  button.toggle-complete:hover,
  button.toggle-complete:focus {
    background: linear-gradient(135deg, #ff9f00 0%, #ffbf47 100%);
    color: #001933;
    outline-offset: 0;
  }
  /* Task list */
  section#task-list {
    margin-top: 1rem;
  }
  ul#tasks {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  ul#tasks li {
    background: #e6f0ff;
    border: 3px solid transparent;
    border-radius: 0.5rem;
    margin-bottom: 1rem;
    padding: 1rem 1rem 1rem 1rem;
    display: grid;
    grid-template-columns: auto 1fr auto auto;
    grid-template-rows: auto auto;
    gap: 0.25rem 1rem;
    align-items: center;
    color: #003366;
    box-shadow: 0 2px 5px rgba(0,80,158,0.2);
    max-width: 100%;
  }
  ul#tasks li[aria-checked="true"] {
    background: #d0f0d0;
    border-color: #28a745;
    color: #155724;
    text-decoration: line-through;
  }
  ul#tasks li[aria-checked="true"] .task-title {
    text-decoration: line-through;
  }
  ul#tasks li .task-title {
    font-weight: 700;
    font-size: 1.125rem;
    word-break: break-word;
  }
  ul#tasks li .task-priority {
    font-weight: 600;
    font-size: 0.875rem;
    border-radius: 0.375rem;
    padding: 0.25rem 0.5rem;
    color: #fff;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
  }
  ul#tasks li .priority-high {
    background-color: #d00000;
  }
  ul#tasks li .priority-medium {
    background-color: #ff9f00;
  }
  ul#tasks li .priority-low {
    background-color: #007a33;
  }
  ul#tasks li .priority-high::before,
  ul#tasks li .priority-medium::before,
  ul#tasks li .priority-low::before {
    content: "";
    display: inline-block;
    width: 0.75rem;
    height: 0.75rem;
    border-radius: 50%;
  }
  ul#tasks li .priority-high::before {
    background-color: #ff4d4d;
  }
  ul#tasks li .priority-medium::before {
    background-color: #ffd966;
  }
  ul#tasks li .priority-low::before {
    background-color: #66d19e;
  }
  ul#tasks li .task-due {
    font-size: 0.875rem;
    color: #003366;
    font-weight: 600;
    grid-column: 2 / 3;
    grid-row: 2 / 3;
  }
  ul#tasks li .task-actions {
    display: flex;
    gap: 0.5rem;
    justify-content: flex-end;
  }
  button.toggle-complete {
    background-color: #007a33;
    color: #fff;
    border-radius: 0.5rem;
    padding: 0.4rem 0.8rem;
    min-width: 44px;
    min-height: 44px;
    font-weight: 700;
    box-shadow: 0 2px 6px rgba(0,122,51,0.6);
    transition: background-color 0.3s ease;
  }
  button.toggle-complete[aria-pressed="true"] {
    background-color: #004d1a;
  }
  button.toggle-complete:hover,
  button.toggle-complete:focus {
    background-color: #004d1a;
    outline-offset: 0;
  }
  button.delete-task {
    background-color: #d00000;
    color: #fff;
    border-radius: 0.5rem;
    padding: 0.4rem 0.8rem;
    min-width: 44px;
    min-height: 44px;
    font-weight: 700;
    box-shadow: 0 2px 6px rgba(208,0,0,0.6);
    transition: background-color 0.3s ease;
  }
  button.delete-task:hover,
  button.delete-task:focus {
    background-color: #7a0000;
    outline-offset: 0;
  }
  /* Visually hidden for accessibility */
  .visually-hidden {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
  }
  /* Responsive */
  @media (max-width: 600px) {
    form {
      grid-template-columns: 1fr;
      gap: 1rem 0;
    }
    ul#tasks li {
      grid-template-columns: 1fr auto auto;
      grid-template-rows: auto auto auto;
      gap: 0.25rem 0.5rem;
    }
    ul#tasks li .task-due {
      grid-column: 1 / 2;
      grid-row: 3 / 4;
    }
  }
  /* Focus ring enhancement for keyboard users */
  :focus-visible {
    outline-offset: 3px;
    outline: 3px solid #ffbf47;
  }
  /* User-selectable colors container */
  #color-controls {
    margin-bottom: 1.5rem;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    align-items: center;
  }
  #color-controls label {
    font-weight: 600;
    color: #003366;
  }
  #color-controls input[type="color"] {
    width: 44px;
    height: 44px;
    border: 2px solid #003366;
    border-radius: 0.5rem;
    cursor: pointer;
    padding: 0;
  }
  /* Live region styling */
  #status-message {
    position: absolute;
    left: -9999px;
    height: 1px;
    width: 1px;
    overflow: hidden;
  }
  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.001ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.001ms !important;
      scroll-behavior: auto !important;
    }
  }
</style>
</head>
<body>
<a href="#main-content" class="skip-link">Skip to main content</a>

<header role="banner">
  <h1>Accessible Interactive To-Do List with Priorities and Due Dates</h1>
</header>

<nav aria-label="Primary site navigation">
  <ul>
    <li><a href="#add-task-form" id="nav-add-task">Add Task</a></li>
    <li><a href="#task-list" id="nav-task-list">Task List</a></li>
    <li><a href="#color-controls" id="nav-color-controls">Color Preferences</a></li>
  </ul>
</nav>

<main id="main-content" tabindex="-1">
  <section aria-labelledby="form-title" id="add-task-section">
    <h2 id="form-title">Add New Task</h2>
    <form id="add-task-form" novalidate aria-describedby="form-help" aria-live="polite">
      <fieldset>
        <legend>Task Details</legend>
        <div>
          <label for="task-title-input">Task Title <span class="required-indicator" aria-hidden="true">*</span></label>
          <input 
            type="text" 
            id="task-title-input" 
            name="task-title" 
            autocomplete="off" 
            required 
            aria-required="true" 
            aria-describedby="title-error title-help"
            aria-invalid="false"
            minlength="2"
            maxlength="100"
            placeholder="Enter task title"
          />
          <div id="title-help" class="visually-hidden">Enter the description of the task. Minimum 2 characters.</div>
          <div id="title-error" class="error-message" aria-live="assertive" role="alert"></div>
        </div>
        <div>
          <label for="task-priority-select">Priority Level <span class="required-indicator" aria-hidden="true">*</span></label>
          <select 
            id="task-priority-select" 
            name="task-priority" 
            required 
            aria-required="true" 
            aria-describedby="priority-error priority-help"
            aria-invalid="false"
          >
            <option value="" disabled selected>Select priority</option>
            <option value="high">High Priority</option>
            <option value="medium">Medium Priority</option>
            <option value="low">Low Priority</option>
          </select>
          <div id="priority-help" class="visually-hidden">Choose the importance level of the task.</div>
          <div id="priority-error" class="error-message" aria-live="assertive" role="alert"></div>
        </div>
        <div>
          <label for="task-due-date">Due Date <span class="required-indicator" aria-hidden="true">*</span></label>
          <input 
            type="date" 
            id="task-due-date" 
            name="task-due-date" 
            required 
            aria-required="true" 
            aria-describedby="due-error due-help"
            aria-invalid="false"
            autocomplete="off"
            min=""
            max=""
          />
          <div id="due-help" class="visually-hidden">Select the due date for the task. Cannot be in the past.</div>
          <div id="due-error" class="error-message" aria-live="assertive" role="alert"></div>
        </div>
      </fieldset>
      <div>
        <button type="submit" aria-label="Add task">Add Task</button>
      </div>
      <div id="form-help" class="visually-hidden">
        All fields are required. Use the tab key to navigate through the form controls.
      </div>
    </form>
  </section>

  <section aria-labelledby="task-list-title" id="task-list">
    <h2 id="task-list-title">Your Tasks</h2>
    <p id="no-tasks-message" role="status" aria-live="polite" style="display:none; font-style: italic; color: #555;">
      You have no tasks. Add one above to get started.
    </p>
    <ul id="tasks" role="list" aria-live="polite" aria-relevant="additions removals">
      <!-- Tasks inserted here -->
    </ul>
  </section>

  <section aria-labelledby="color-controls-title" id="color-controls" tabindex="-1">
    <h2 id="color-controls-title">Customize Colors</h2>
    <p>Choose foreground and background colors to enhance readability and comfort. Your selections will be applied immediately.</p>
    <form id="color-preferences-form" aria-describedby="color-help" novalidate>
      <div>
        <label for="foreground-color-picker">Text Color</label>
        <input type="color" id="foreground-color-picker" name="foreground-color" value="#111111" aria-describedby="color-help" />
      </div>
      <div>
        <label for="background-color-picker">Background Color</label>
        <input type="color" id="background-color-picker" name="background-color" value="#ffffff" aria-describedby="color-help" />
      </div>
      <div>
        <button type="button" id="reset-colors" aria-label="Reset colors to default">Reset Colors</button>
      </div>
      <div id="color-help" class="visually-hidden">
        Use the color pickers to select your preferred text and background colors. Colors must maintain sufficient contrast.
      </div>
    </form>
  </section>
</main>

<footer role="contentinfo" style="background-color:#003366; color:#ffbf47; padding: 1rem; text-align:center; font-size:0.875rem;">
  <p>© 2024 Accessible To-Do List Application. All rights reserved.</p>
</footer>

<div id="status-message" role="status" aria-live="polite" aria-atomic="true"></div>

<script>
(() => {
  'use strict';

  // Utility functions
  const $ = (selector, scope = document) => scope.querySelector(selector);
  const $$ = (selector, scope = document) => Array.from(scope.querySelectorAll(selector));

  // Elements
  const form = $('#add-task-form');
  const taskTitleInput = $('#task-title-input');
  const taskPrioritySelect = $('#task-priority-select');
  const taskDueDateInput = $('#task-due-date');
  const tasksList = $('#tasks');
  const noTasksMessage = $('#no-tasks-message');
  const statusMessage = $('#status-message');
  const colorForm = $('#color-preferences-form');
  const fgColorPicker = $('#foreground-color-picker');
  const bgColorPicker = $('#background-color-picker');
  const resetColorsBtn = $('#reset-colors');

  // Error message elements
  const titleError = $('#title-error');
  const priorityError = $('#priority-error');
  const dueError = $('#due-error');

  // Constants
  const PRIORITY_LABELS = {
    high: 'High Priority',
    medium: 'Medium Priority',
    low: 'Low Priority'
  };

  // Store tasks in memory (can be extended to localStorage)
  let tasks = [];

  // Accessibility: update min/max for due date input dynamically (today to 1 year ahead)
  function updateDueDateLimits() {
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');
    const minDate = `${yyyy}-${mm}-${dd}`;
    taskDueDateInput.min = minDate;

    const nextYear = new Date(today);
    nextYear.setFullYear(nextYear.getFullYear() + 1);
    const yyyy2 = nextYear.getFullYear();
    const mm2 = String(nextYear.getMonth() + 1).padStart(2, '0');
    const dd2 = String(nextYear.getDate()).padStart(2, '0');
    const maxDate = `${yyyy2}-${mm2}-${dd2}`;
    taskDueDateInput.max = maxDate;
  }

  // Validate inputs, show errors, return boolean valid
  function validateForm() {
    let valid = true;

    // Title validation: required, min 2 chars
    const titleVal = taskTitleInput.value.trim();
    if (!titleVal) {
      titleError.textContent = 'Task title is required.';
      taskTitleInput.setAttribute('aria-invalid', 'true');
      valid = false;
    } else if (titleVal.length < 2) {
      titleError.textContent = 'Task title must be at least 2 characters.';
      taskTitleInput.setAttribute('aria-invalid', 'true');
      valid = false;
    } else if (titleVal.length > 100) {
      titleError.textContent = 'Task title must be 100 characters or fewer.';
      taskTitleInput.setAttribute('aria-invalid', 'true');
      valid = false;
    } else {
      titleError.textContent = '';
      taskTitleInput.setAttribute('aria-invalid', 'false');
    }

    // Priority validation: required and must be one of options
    const priorityVal = taskPrioritySelect.value;
    if (!priorityVal) {
      priorityError.textContent = 'Priority level is required.';
      taskPrioritySelect.setAttribute('aria-invalid', 'true');
      valid = false;
    } else if (!Object.keys(PRIORITY_LABELS).includes(priorityVal)) {
      priorityError.textContent = 'Invalid priority level selected.';
      taskPrioritySelect.setAttribute('aria-invalid', 'true');
      valid = false;
    } else {
      priorityError.textContent = '';
      taskPrioritySelect.setAttribute('aria-invalid', 'false');
    }

    // Due date validation: required, not past, within max range
    const dueVal = taskDueDateInput.value;
    if (!dueVal) {
      dueError.textContent = 'Due date is required.';
      taskDueDateInput.setAttribute('aria-invalid', 'true');
      valid = false;
    } else {
      const dueDate = new Date(dueVal);
      const today = new Date();
      today.setHours(0,0,0,0);
      if (dueDate < today) {
        dueError.textContent = 'Due date cannot be in the past.';
        taskDueDateInput.setAttribute('aria-invalid', 'true');
        valid = false;
      } else if (dueDate > new Date(taskDueDateInput.max)) {
        dueError.textContent = 'Due date must be within one year from today.';
        taskDueDateInput.setAttribute('aria-invalid', 'true');
        valid = false;
      } else {
        dueError.textContent = '';
        taskDueDateInput.setAttribute('aria-invalid', 'false');
      }
    }

    return valid;
  }

  // Clear form inputs and errors
  function clearForm() {
    form.reset();
    titleError.textContent = '';
    priorityError.textContent = '';
    dueError.textContent = '';
    taskTitleInput.setAttribute('aria-invalid', 'false');
    taskPrioritySelect.setAttribute('aria-invalid', 'false');
    taskDueDateInput.setAttribute('aria-invalid', 'false');
    taskTitleInput.focus();
  }

  // Format date to human-readable, localized string with pronunciation hints if needed
  function formatDueDate(dateStr) {
    try {
      const date = new Date(dateStr);
      if (isNaN(date)) return '';
      // Use Intl.DateTimeFormat for localized, accessible date
      const formatter = new Intl.DateTimeFormat('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        weekday: 'long'
      });
      return formatter.format(date);
    } catch {
      return dateStr;
    }
  }

  // Create task list item DOM element with ARIA roles and properties
  function createTaskListItem(task) {
    const li = document.createElement('li');
    li.setAttribute('role', 'listitem');
    li.setAttribute('tabindex', '-1');
    li.setAttribute('aria-checked', task.completed ? 'true' : 'false');
    li.setAttribute('aria-label', `Task: ${task.title}, Priority: ${PRIORITY_LABELS[task.priority]}, Due: ${formatDueDate(task.dueDate)}, ${task.completed ? 'Completed' : 'Not completed'}`);

    // Title
    const titleSpan = document.createElement('span');
    titleSpan.className = 'task-title';
    titleSpan.textContent = task.title;
    li.appendChild(titleSpan);

    // Priority label with icon and text
    const prioritySpan = document.createElement('span');
    prioritySpan.className = `task-priority priority-${task.priority}`;
    prioritySpan.setAttribute('aria-label', `Priority level: ${PRIORITY_LABELS[task.priority]}`);
    prioritySpan.title = PRIORITY_LABELS[task.priority];
    prioritySpan.textContent = PRIORITY_LABELS[task.priority];
    li.appendChild(prioritySpan);

    // Due date
    const dueSpan = document.createElement('span');
    dueSpan.className = 'task-due';
    dueSpan.textContent = `Due: ${formatDueDate(task.dueDate)}`;
    li.appendChild(dueSpan);

    // Actions container
    const actionsDiv = document.createElement('div');
    actionsDiv.className = 'task-actions';

    // Toggle complete button
    const toggleBtn = document.createElement('button');
    toggleBtn.type = 'button';
    toggleBtn.className = 'toggle-complete';
    toggleBtn.setAttribute('aria-pressed', task.completed ? 'true' : 'false');
    toggleBtn.setAttribute('aria-label', task.completed ? `Mark task "${task.title}" as incomplete` : `Mark task "${task.title}" as completed`);
    toggleBtn.textContent = task.completed ? 'Undo' : 'Complete';
    toggleBtn.addEventListener('click', () => toggleTaskCompletion(task.id));
    toggleBtn.addEventListener('keydown', e => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleBtn.click();
      }
    });
    actionsDiv.appendChild(toggleBtn);

    // Delete button
    const deleteBtn = document.createElement('button');
    deleteBtn.type = 'button';
    deleteBtn.className = 'delete-task';
    deleteBtn.setAttribute('aria-label', `Delete task "${task.title}"`);
    deleteBtn.textContent = 'Delete';
    deleteBtn.addEventListener('click', () => deleteTask(task.id));
    deleteBtn.addEventListener('keydown', e => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        deleteBtn.click();
      }
    });
    actionsDiv.appendChild(deleteBtn);

    li.appendChild(actionsDiv);

    return li;
  }

  // Render all tasks to the list
  function renderTasks() {
    tasksList.innerHTML = '';
    if (tasks.length === 0) {
      noTasksMessage.style.display = 'block';
      return;
    }
    noTasksMessage.style.display = 'none';

    // Sort tasks by due date ascending, then priority descending (high first)
    const priorityOrder = { high: 3, medium: 2, low: 1 };
    const sortedTasks = [...tasks].sort((a, b) => {
      const dateA = new Date(a.dueDate);
      const dateB = new Date(b.dueDate);
      if (dateA < dateB) return -1;
      if (dateA > dateB) return 1;
      return priorityOrder[b.priority] - priorityOrder[a.priority];
    });

    sortedTasks.forEach(task => {
      const taskItem = createTaskListItem(task);
      tasksList.appendChild(taskItem);
    });
  }

  // Add new task to tasks array and re-render
  function addTask(task) {
    tasks.push(task);
    renderTasks();
    announceStatus(`Task "${task.title}" added.`);
  }

  // Toggle completion state of a task by id
  function toggleTaskCompletion(taskId) {
    const task = tasks.find(t => t.id === taskId);
    if (!task) return;
    task.completed = !task.completed;
    renderTasks();
    announceStatus(`Task "${task.title}" marked as ${task.completed ? 'completed' : 'not completed'}.`);
  }

  // Delete task by id
  function deleteTask(taskId) {
    const index = tasks.findIndex(t => t.id === taskId);
    if (index === -1) return;
    const removed = tasks.splice(index, 1)[0];
    renderTasks();
    announceStatus(`Task "${removed.title}" deleted.`);
  }

  // Announce status messages for screen readers
  function announceStatus(message) {
    statusMessage.textContent = '';
    setTimeout(() => {
      statusMessage.textContent = message;
    }, 100);
  }

  // Generate unique ID for tasks
  function generateId() {
    return `task-${Date.now()}-${Math.floor(Math.random() * 1000)}`;
  }

  // Handle form submission
  form.addEventListener('submit', e => {
    e.preventDefault();
    if (!validateForm()) {
      announceStatus('Please correct the errors in the form before submitting.');
      return;
    }
    const newTask = {
      id: generateId(),
      title: taskTitleInput.value.trim(),
      priority: taskPrioritySelect.value,
      dueDate: taskDueDateInput.value,
      completed: false
    };
    addTask(newTask);
    clearForm();
  });

  // Keyboard accessibility for nav links: focus management
  const navLinks = $$('nav a');
  navLinks.forEach(link => {
    link.addEventListener('keydown', e => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        const targetId = link.getAttribute('href').substring(1);
        const targetEl = document.getElementById(targetId);
        if (targetEl) {
          targetEl.focus();
        }
      }
    });
  });

  // Color preferences with validation and application
  function applyColors(fg, bg) {
    // Contrast check function (WCAG 2.2 AAA minimum 7:1)
    function luminance(r, g, b) {
      const a = [r, g, b].map(v => {
        v /= 255;
        return v <= 0.03928
          ? v / 12.92
          : Math.pow((v + 0.055) / 1.055, 2.4);
      });
      return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;
    }
    function contrast(rgb1, rgb2) {
      const lum1 = luminance(...rgb1);
      const lum2 = luminance(...rgb2);
      const brightest = Math.max(lum1, lum2);
      const darkest = Math.min(lum1, lum2);
      return (brightest + 0.05) / (darkest + 0.05);
    }
    function hexToRgb(hex) {
      const parsed = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return parsed ? [
        parseInt(parsed[1], 16),
        parseInt(parsed[2], 16),
        parseInt(parsed[3], 16)
      ] : null;
    }
    const fgRgb = hexToRgb(fg);
    const bgRgb = hexToRgb(bg);
    if (!fgRgb || !bgRgb) return false;
    const c = contrast(fgRgb, bgRgb);
    if (c < 7) return false;

    // Apply colors to body text and background
    document.body.style.color = fg;
    document.body.style.background = bg;

    // Also adjust form backgrounds for contrast
    const main = $('main');
    if (main) {
      main.style.backgroundColor = bg === '#ffffff' ? '#ffffffee' : bg;
      main.style.color = fg;
    }
    return true;
  }

  // Load saved colors from localStorage or defaults
  function loadColors() {
    const fg = localStorage.getItem('todo-fg-color') || '#111111';
    const bg = localStorage.getItem('todo-bg-color') || '#ffffff';
    fgColorPicker.value = fg;
    bgColorPicker.value = bg;
    applyColors(fg, bg);
  }

  // Handle color picker changes
  fgColorPicker.addEventListener('input', () => {
    const fg = fgColorPicker.value;
    const bg = bgColorPicker.value;
    if (!applyColors(fg, bg)) {
      announceStatus('Selected colors do not meet contrast requirements. Please choose different colors.');
    } else {
      localStorage.setItem('todo-fg-color', fg);
      localStorage.setItem('todo-bg-color', bg);
      announceStatus('Text color updated.');
    }
  });

  bgColorPicker.addEventListener('input', () => {
    const fg = fgColorPicker.value;
    const bg = bgColorPicker.value;
    if (!applyColors(fg, bg)) {
      announceStatus('Selected colors do not meet contrast requirements. Please choose different colors.');
    } else {
      localStorage.setItem('todo-fg-color', fg);
      localStorage.setItem('todo-bg-color', bg);
      announceStatus('Background color updated.');
    }
  });

  resetColorsBtn.addEventListener('click', () => {
    fgColorPicker.value = '#111111';
    bgColorPicker.value = '#ffffff';
    applyColors('#111111', '#ffffff');
    localStorage.removeItem('todo-fg-color');
    localStorage.removeItem('todo-bg-color');
    announceStatus('Colors reset to default.');
    fgColorPicker.focus();
  });

  // Initialize
  function init() {
    updateDueDateLimits();
    loadColors();
    renderTasks();
  }

  // Run init on DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>
</body>
</html>