<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2" />
<title>Creative Share Hub â€“ Upload and Showcase Your Photos & Art</title>
<style>
  /* Reset and base */
  *, *::before, *::after {
    box-sizing: border-box;
  }
  html {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    font-size: 18px;
    line-height: 1.6;
    background: linear-gradient(135deg, #1a237e, #0d47a1);
    color: #f0f0f0;
    scroll-behavior: smooth;
  }
  body {
    margin: 0;
    padding: 0;
    background-color: #0d47a1;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  a {
    color: #ffcc00;
    text-decoration: underline;
  }
  a:focus,
  button:focus,
  input:focus,
  select:focus,
  textarea:focus {
    outline: 3px solid #ffcc00;
    outline-offset: 2px;
  }
  /* Skip link */
  #skip-link {
    position: absolute;
    top: -40px;
    left: 1rem;
    background: #ffcc00;
    color: #0d47a1;
    padding: 0.5rem 1rem;
    z-index: 100;
    border-radius: 0 0 4px 4px;
    font-weight: 700;
    text-decoration: none;
  }
  #skip-link:focus {
    top: 1rem;
  }

  header {
    background: #283593;
    padding: 1rem 1.5rem;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }
  header h1 {
    margin: 0;
    font-size: 2rem;
    color: #ffcc00;
    text-shadow: 1px 1px 2px #000000cc;
  }
  /* Navigation */
  nav[aria-label="Primary"] {
    background: #3949ab;
    display: flex;
    justify-content: center;
    box-shadow: inset 0 -3px 0 #ffcc00;
  }
  nav[aria-label="Primary"] ul {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    gap: 1.5rem;
  }
  nav[aria-label="Primary"] li {
    position: relative;
  }
  nav[aria-label="Primary"] a,
  nav[aria-label="Primary"] button.menu-toggle {
    color: #ffcc00;
    background: none;
    border: none;
    font-weight: 700;
    font-size: 1rem;
    padding: 1rem 0.25rem;
    cursor: pointer;
    text-decoration: none;
    min-width: 44px;
    min-height: 44px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  nav[aria-label="Primary"] a:hover,
  nav[aria-label="Primary"] a:focus,
  nav[aria-label="Primary"] button.menu-toggle:hover,
  nav[aria-label="Primary"] button.menu-toggle:focus {
    color: #fff59d;
    outline-offset: 3px;
  }
  /* Dropdown menu */
  .submenu {
    position: absolute;
    top: 100%;
    left: 0;
    background: #283593;
    border: 2px solid #ffcc00;
    border-radius: 4px;
    padding: 0.5rem 0;
    min-width: 180px;
    display: none;
    z-index: 200;
  }
  .submenu[aria-hidden="false"] {
    display: block;
  }
  .submenu li {
    padding: 0;
  }
  .submenu a {
    display: block;
    padding: 0.5rem 1rem;
    color: #ffcc00;
    font-weight: 600;
  }
  .submenu a:hover,
  .submenu a:focus {
    background: #3949ab;
    color: #fff59d;
    outline-offset: 2px;
  }

  /* Mobile nav toggle */
  .menu-toggle {
    display: none;
  }
  @media (max-width: 768px) {
    nav[aria-label="Primary"] ul {
      flex-direction: column;
      background: #283593;
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-in-out;
      border-top: 2px solid #ffcc00;
    }
    nav[aria-label="Primary"] ul.open {
      max-height: 400px;
      overflow-y: auto;
    }
    nav[aria-label="Primary"] li {
      width: 100%;
    }
    nav[aria-label="Primary"] a,
    nav[aria-label="Primary"] button.menu-toggle {
      width: 100%;
      padding: 1rem 1.5rem;
      text-align: left;
    }
    .menu-toggle {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: none;
      border: none;
      color: #ffcc00;
      font-size: 1.5rem;
      cursor: pointer;
      min-width: 44px;
      min-height: 44px;
    }
    .submenu {
      position: static;
      border: none;
      background: #3949ab;
      padding-left: 1rem;
      border-radius: 0 0 0 4px;
      box-shadow: none;
      display: none !important;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-in-out;
    }
    .submenu[aria-hidden="false"] {
      display: block !important;
      max-height: 1000px;
      overflow: visible;
    }
  }

  main {
    flex: 1 0 auto;
    max-width: 900px;
    margin: 2rem auto;
    background: #1a237e;
    border-radius: 8px;
    padding: 2rem;
    box-shadow: 0 0 15px #ffcc00aa;
  }
  main h2 {
    color: #ffcc00;
    font-size: 1.75rem;
    margin-top: 0;
    margin-bottom: 1rem;
    border-bottom: 2px solid #ffcc00;
    padding-bottom: 0.25rem;
  }
  section {
    margin-bottom: 2rem;
  }

  /* Form styles */
  form {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }
  fieldset {
    border: 2px solid #ffcc00;
    border-radius: 6px;
    padding: 1rem 1.25rem 1.5rem 1.25rem;
    background: #283593;
  }
  legend {
    font-weight: 700;
    color: #ffcc00;
    font-size: 1.25rem;
    padding: 0 0.5rem;
  }
  label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.25rem;
    color: #fff59d;
  }
  input[type="text"],
  input[type="url"],
  textarea {
    width: 100%;
    padding: 0.5rem 0.75rem;
    border-radius: 4px;
    border: 2px solid #ffcc00;
    font-size: 1rem;
    font-family: inherit;
    background: #3949ab;
    color: #f0f0f0;
  }
  input[type="text"]:focus,
  input[type="url"]:focus,
  textarea:focus {
    border-color: #fff59d;
    outline: none;
  }
  textarea {
    resize: vertical;
    min-height: 80px;
  }
  .required-indicator {
    color: #ffcc00;
    margin-left: 0.25rem;
  }
  .help-text {
    font-size: 0.875rem;
    color: #fff59d;
    margin-top: -0.75rem;
    margin-bottom: 0.5rem;
  }
  .error-message {
    color: #ff4444;
    font-weight: 700;
    font-size: 0.9rem;
    margin-top: 0.25rem;
  }

  /* Tags input */
  #tags-input {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    padding: 0.25rem;
    border: 2px solid #ffcc00;
    border-radius: 4px;
    background: #3949ab;
  }
  #tags-input input {
    border: none;
    background: transparent;
    color: #f0f0f0;
    font-size: 1rem;
    min-width: 120px;
    padding: 0.25rem 0.5rem;
  }
  #tags-input input:focus {
    outline: none;
  }
  .tag {
    background: #ffcc00;
    color: #0d47a1;
    font-weight: 700;
    padding: 0.25rem 0.5rem;
    border-radius: 16px;
    display: flex;
    align-items: center;
    gap: 0.25rem;
    user-select: none;
  }
  .tag button {
    background: none;
    border: none;
    color: #0d47a1;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    padding: 0;
    margin-left: 0.25rem;
    line-height: 1;
    min-width: 44px;
    min-height: 44px;
  }
  .tag button:focus {
    outline: 3px solid #0d47a1;
    outline-offset: 2px;
  }

  /* File upload */
  .file-upload {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  .file-upload input[type="file"] {
    border: 2px solid #ffcc00;
    border-radius: 4px;
    padding: 0.5rem;
    background: #3949ab;
    color: #f0f0f0;
    cursor: pointer;
  }
  .file-upload input[type="file"]:focus {
    outline: 3px solid #fff59d;
    outline-offset: 2px;
  }
  .preview-container {
    margin-top: 1rem;
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
  }
  .preview-card {
    background: #283593;
    border: 2px solid #ffcc00;
    border-radius: 8px;
    width: 180px;
    padding: 0.5rem;
    box-shadow: 0 0 8px #ffcc00aa;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  .preview-card img {
    width: 100%;
    height: auto;
    border-radius: 4px;
    object-fit: cover;
  }
  .preview-card h3 {
    font-size: 1.1rem;
    margin: 0;
    color: #ffcc00;
  }
  .preview-card p {
    font-size: 0.9rem;
    margin: 0;
    color: #fff59d;
    overflow-wrap: break-word;
  }
  .preview-card .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
  }
  .preview-card .tags span {
    background: #ffcc00;
    color: #0d47a1;
    font-weight: 700;
    padding: 0.15rem 0.5rem;
    border-radius: 12px;
    font-size: 0.75rem;
    user-select: none;
  }
  .preview-card button.remove-btn {
    background: #ff4444;
    color: #fff;
    border: none;
    border-radius: 4px;
    padding: 0.3rem 0.5rem;
    font-weight: 700;
    cursor: pointer;
    align-self: flex-end;
    min-width: 44px;
    min-height: 44px;
  }
  .preview-card button.remove-btn:focus {
    outline: 3px solid #fff59d;
    outline-offset: 2px;
  }

  /* Submit button */
  button[type="submit"] {
    background: #ffcc00;
    color: #0d47a1;
    font-weight: 700;
    font-size: 1.1rem;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    align-self: start;
    min-width: 120px;
    min-height: 44px;
    box-shadow: 0 0 10px #ffcc00cc;
    transition: background-color 0.3s ease;
  }
  button[type="submit"]:hover,
  button[type="submit"]:focus {
    background: #fff59d;
    color: #0d47a1;
    outline-offset: 2px;
  }
  button[type="submit"]:disabled {
    background: #999999;
    color: #555555;
    cursor: not-allowed;
    box-shadow: none;
  }

  /* Status message */
  #status-message {
    margin-top: 1rem;
    font-weight: 700;
    font-size: 1rem;
    color: #80deea;
  }
  #status-message.error {
    color: #ff4444;
  }

  /* Gallery */
  #gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(220px,1fr));
    gap: 1.5rem;
  }
  .gallery-item {
    background: #283593;
    border: 2px solid #ffcc00;
    border-radius: 8px;
    padding: 0.75rem;
    box-shadow: 0 0 10px #ffcc00aa;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  .gallery-item img {
    width: 100%;
    height: auto;
    border-radius: 6px;
    object-fit: cover;
  }
  .gallery-item h3 {
    margin: 0;
    font-size: 1.1rem;
    color: #ffcc00;
  }
  .gallery-item p.description {
    margin: 0;
    color: #fff59d;
    font-size: 0.9rem;
  }
  .gallery-item .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.3rem;
  }
  .gallery-item .tags span {
    background: #ffcc00;
    color: #0d47a1;
    font-weight: 700;
    padding: 0.15rem 0.5rem;
    border-radius: 12px;
    font-size: 0.75rem;
    user-select: none;
  }

  /* Responsive typography */
  @media (min-width: 600px) {
    html {
      font-size: 20px;
    }
  }
  @media (min-width: 900px) {
    html {
      font-size: 22px;
    }
  }

  /* Focus visible enhancement */
  :focus-visible {
    outline-offset: 3px;
    outline: 3px solid #ffcc00;
  }

  /* User-selectable colors container */
  #color-controls {
    margin-bottom: 1.5rem;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    align-items: center;
  }
  #color-controls label {
    font-weight: 700;
    color: #ffcc00;
  }
  #color-controls select {
    padding: 0.3rem 0.5rem;
    border-radius: 4px;
    border: 2px solid #ffcc00;
    background: #3949ab;
    color: #f0f0f0;
    font-size: 1rem;
  }
  #color-controls select:focus {
    outline: 3px solid #fff59d;
    outline-offset: 2px;
  }
</style>
</head>
<body>
<a href="#main-content" id="skip-link">Skip to main content</a>
<header>
  <h1>Creative Share Hub</h1>
</header>
<nav aria-label="Primary" role="navigation">
  <button class="menu-toggle" aria-expanded="false" aria-controls="primary-menu" aria-haspopup="true" aria-label="Toggle main menu">&#9776;</button>
  <ul id="primary-menu" role="menubar">
    <li role="none">
      <a href="#upload-section" role="menuitem" tabindex="0">Upload</a>
    </li>
    <li role="none">
      <a href="#gallery-section" role="menuitem" tabindex="0">Gallery</a>
    </li>
    <li role="none">
      <button aria-haspopup="true" aria-expanded="false" aria-controls="submenu-about" role="menuitem" tabindex="0" aria-label="About submenu">About â–¼</button>
      <ul class="submenu" id="submenu-about" role="menu" aria-hidden="true">
        <li role="none"><a href="#about-site" role="menuitem" tabindex="-1">Site Info</a></li>
        <li role="none"><a href="#help-section" role="menuitem" tabindex="-1">Help</a></li>
      </ul>
    </li>
  </ul>
</nav>
<main id="main-content" tabindex="-1">
  <section id="upload-section" aria-labelledby="upload-heading">
    <h2 id="upload-heading">Upload Your Creative Work</h2>
    <p>Share your photos and artwork with the community. Add a description and tags to help others find your creations.</p>
    <form id="upload-form" novalidate aria-describedby="form-help" aria-live="polite" aria-atomic="true">
      <fieldset>
        <legend>Upload Details</legend>

        <div>
          <label for="file-input">Select image file to upload <span aria-hidden="true" class="required-indicator">*</span></label>
          <input 
            type="file" 
            id="file-input" 
            name="file-input" 
            accept="image/jpeg,image/png,image/webp" 
            required 
            aria-required="true" 
            aria-describedby="file-help file-error" 
            aria-invalid="false"
          />
          <p id="file-help" class="help-text">Accepted formats: JPEG, PNG, WEBP. Max size: 5MB.</p>
          <p id="file-error" class="error-message" role="alert" aria-live="assertive" hidden></p>
        </div>

        <div>
          <label for="description-input">Description <span aria-hidden="true" class="required-indicator">*</span></label>
          <textarea 
            id="description-input" 
            name="description-input" 
            rows="4" 
            maxlength="500" 
            required 
            aria-required="true" 
            aria-describedby="desc-help desc-error" 
            aria-invalid="false" 
            autocomplete="off"
            placeholder="Describe your work (max 500 characters)"
          ></textarea>
          <p id="desc-help" class="help-text">Provide a brief description of your creative work.</p>
          <p id="desc-error" class="error-message" role="alert" aria-live="assertive" hidden></p>
        </div>

        <fieldset>
          <legend>Tags <span aria-hidden="true" class="required-indicator">*</span></legend>
          <p id="tags-help" class="help-text">Add up to 8 tags to categorize your work. Press Enter or comma to add a tag.</p>
          <div id="tags-input" role="list" aria-live="polite" aria-atomic="true" aria-describedby="tags-help tags-error">
            <input 
              type="text" 
              id="tag-text-input" 
              aria-label="Add tags" 
              autocomplete="off" 
              aria-invalid="false"
              maxlength="30"
              placeholder="Enter a tag"
              aria-required="true"
              aria-describedby="tags-help tags-error"
            />
          </div>
          <p id="tags-error" class="error-message" role="alert" aria-live="assertive" hidden></p>
        </fieldset>
      </fieldset>
      <button type="submit" id="submit-button" disabled>Share Work</button>
      <div id="status-message" role="status" aria-live="polite"></div>
    </form>
  </section>

  <section id="gallery-section" aria-labelledby="gallery-heading">
    <h2 id="gallery-heading">Community Gallery</h2>
    <p>Explore the creative works shared by others. Use the search below to find specific pieces by description or tags.</p>
    <label for="search-input" class="visually-hidden">Search gallery</label>
    <input 
      type="search" 
      id="search-input" 
      name="search-input" 
      placeholder="Search by description or tags" 
      aria-describedby="search-help"
      autocomplete="off"
      style="width:100%; max-width:400px; margin-bottom:1rem; padding:0.5rem; font-size:1rem; border-radius:4px; border:2px solid #ffcc00; background:#3949ab; color:#f0f0f0;"
    />
    <p id="search-help" class="help-text">Search is case-insensitive and matches tags or description text.</p>
    <div id="gallery" aria-live="polite" aria-relevant="additions removals" aria-atomic="false" tabindex="0" aria-label="Gallery of shared creative works"></div>
  </section>

  <section id="about-site" aria-labelledby="about-heading">
    <h2 id="about-heading">About Creative Share Hub</h2>
    <p>Creative Share Hub is a welcoming platform designed for artists and photographers to upload, describe, and tag their creative works for sharing with the community. We prioritize accessibility and inclusivity, ensuring everyone can enjoy and contribute.</p>
  </section>

  <section id="help-section" aria-labelledby="help-heading">
    <h2 id="help-heading">Help & Accessibility Information</h2>
    <p>This website fully complies with WCAG 2.2 AAA standards to ensure maximum accessibility. If you need assistance with uploading or navigating, please contact our support team.</p>
    <p><strong>Keyboard Navigation:</strong> Use Tab and Shift+Tab to navigate through interactive elements. Press Enter or Space to activate buttons and menu items. Use Escape to close menus.</p>
    <p><strong>Form Guidance:</strong> Required fields are marked with an asterisk (<span aria-hidden="true">*</span>). Error messages appear below fields if input is invalid.</p>
    <p><strong>Reduced Motion:</strong> The site respects your system preference for reduced motion and disables non-essential animations accordingly.</p>
  </section>
</main>
<footer role="contentinfo" style="background:#283593; color:#ffcc00; padding:1rem 1.5rem; text-align:center; font-size:0.9rem;">
  <p>Â© 2024 Creative Share Hub. All rights reserved.</p>
  <p><a href="#upload-section">Upload</a> | <a href="#gallery-section">Gallery</a> | <a href="#help-section">Help</a></p>
</footer>

<script>
  (() => {
    'use strict';

    // Elements
    const menuToggleBtn = document.querySelector('.menu-toggle');
    const primaryMenu = document.getElementById('primary-menu');
    const submenuButtons = primaryMenu.querySelectorAll('button[aria-haspopup="true"]');
    const uploadForm = document.getElementById('upload-form');
    const fileInput = document.getElementById('file-input');
    const descriptionInput = document.getElementById('description-input');
    const tagTextInput = document.getElementById('tag-text-input');
    const tagsInputContainer = document.getElementById('tags-input');
    const tagsError = document.getElementById('tags-error');
    const fileError = document.getElementById('file-error');
    const descError = document.getElementById('desc-error');
    const submitButton = document.getElementById('submit-button');
    const statusMessage = document.getElementById('status-message');
    const gallery = document.getElementById('gallery');
    const searchInput = document.getElementById('search-input');

    // State
    let tags = [];
    let galleryItems = [];

    // Constants
    const MAX_TAGS = 8;
    const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB
    const ALLOWED_TYPES = ['image/jpeg', 'image/png', 'image/webp'];

    // Utility: Sanitize text for safe HTML insertion
    function sanitizeHTML(str) {
      const temp = document.createElement('div');
      temp.textContent = str;
      return temp.innerHTML;
    }

    // Menu toggle for mobile
    menuToggleBtn.addEventListener('click', () => {
      const expanded = menuToggleBtn.getAttribute('aria-expanded') === 'true';
      menuToggleBtn.setAttribute('aria-expanded', String(!expanded));
      primaryMenu.classList.toggle('open');
      if (!expanded) {
        // Focus first menu item
        const firstItem = primaryMenu.querySelector('a, button.menu-toggle');
        if (firstItem) firstItem.focus();
      } else {
        menuToggleBtn.focus();
      }
    });

    // Submenu toggles
    submenuButtons.forEach(button => {
      const submenuId = button.getAttribute('aria-controls');
      const submenu = document.getElementById(submenuId);
      button.addEventListener('click', () => {
        const expanded = button.getAttribute('aria-expanded') === 'true';
        closeAllSubmenus();
        if (!expanded) {
          button.setAttribute('aria-expanded', 'true');
          submenu.setAttribute('aria-hidden', 'false');
          // Focus first submenu item
          const firstSubItem = submenu.querySelector('a');
          if (firstSubItem) firstSubItem.tabIndex = 0;
          firstSubItem?.focus();
        } else {
          button.setAttribute('aria-expanded', 'false');
          submenu.setAttribute('aria-hidden', 'true');
        }
      });
      // Keyboard navigation inside submenu button
      button.addEventListener('keydown', e => {
        if (e.key === 'ArrowDown' || e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          button.click();
        }
        if (e.key === 'Escape') {
          e.preventDefault();
          button.setAttribute('aria-expanded', 'false');
          submenu.setAttribute('aria-hidden', 'true');
          button.focus();
        }
      });
    });

    // Close all submenus helper
    function closeAllSubmenus() {
      submenuButtons.forEach(button => {
        const submenuId = button.getAttribute('aria-controls');
        const submenu = document.getElementById(submenuId);
        button.setAttribute('aria-expanded', 'false');
        submenu.setAttribute('aria-hidden', 'true');
        // Reset tabindex on submenu items
        submenu.querySelectorAll('a').forEach(a => a.tabIndex = -1);
      });
    }

    // Close submenus on outside click or Escape
    document.addEventListener('click', (e) => {
      if (!primaryMenu.contains(e.target)) {
        closeAllSubmenus();
      }
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeAllSubmenus();
      }
    });

    // Tag input management
    function renderTags() {
      // Remove all tag elements except input
      const existingTags = tagsInputContainer.querySelectorAll('.tag');
      existingTags.forEach(tagEl => tagsInputContainer.removeChild(tagEl));
      tags.forEach((tag, index) => {
        const tagEl = document.createElement('span');
        tagEl.className = 'tag';
        tagEl.setAttribute('role', 'listitem');
        tagEl.textContent = tag;
        const removeBtn = document.createElement('button');
        removeBtn.type = 'button';
        removeBtn.setAttribute('aria-label', `Remove tag ${tag}`);
        removeBtn.textContent = 'Ã—';
        removeBtn.addEventListener('click', () => {
          tags.splice(index, 1);
          renderTags();
          validateTags();
          updateSubmitState();
        });
        tagEl.appendChild(removeBtn);
        tagsInputContainer.insertBefore(tagEl, tagTextInput);
      });
    }

    function addTag(tag) {
      tag = tag.trim().toLowerCase();
      if (!tag) return;
      if (tags.includes(tag)) {
        setTagsError('Duplicate tags are not allowed.');
        return;
      }
      if (tags.length >= MAX_TAGS) {
        setTagsError(`You can add up to ${MAX_TAGS} tags.`);
        return;
      }
      if (tag.length > 30) {
        setTagsError('Tags must be 30 characters or less.');
        return;
      }
      if (!/^[\p{L}\p{N}\-_]+$/u.test(tag)) {
        setTagsError('Tags may only contain letters, numbers, hyphens, and underscores.');
        return;
      }
      tags.push(tag);
      clearTagsError();
      renderTags();
      updateSubmitState();
    }

    function setTagsError(message) {
      tagsError.textContent = message;
      tagsError.hidden = false;
      tagTextInput.setAttribute('aria-invalid', 'true');
    }
    function clearTagsError() {
      tagsError.textContent = '';
      tagsError.hidden = true;
      tagTextInput.setAttribute('aria-invalid', 'false');
    }
    function validateTags() {
      if (tags.length === 0) {
        setTagsError('At least one tag is required.');
        return false;
      }
      clearTagsError();
      return true;
    }

    tagTextInput.addEventListener('keydown', e => {
      if (e.key === 'Enter' || e.key === ',' || e.key === 'Tab') {
        if (e.key !== 'Tab') e.preventDefault();
        const value = tagTextInput.value.trim();
        if (value) {
          addTag(value);
          tagTextInput.value = '';
        }
      }
      if (e.key === 'Escape') {
        tagTextInput.value = '';
        clearTagsError();
      }
    });

    tagTextInput.addEventListener('blur', () => {
      const value = tagTextInput.value.trim();
      if (value) {
        addTag(value);
        tagTextInput.value = '';
      }
    });

    // File input validation
    function validateFile() {
      const file = fileInput.files[0];
      if (!file) {
        setFileError('Please select an image file to upload.');
        return false;
      }
      if (!ALLOWED_TYPES.includes(file.type)) {
        setFileError('Unsupported file type. Allowed: JPEG, PNG, WEBP.');
        return false;
      }
      if (file.size > MAX_FILE_SIZE) {
        setFileError('File size exceeds 5MB limit.');
        return false;
      }
      clearFileError();
      return true;
    }
    function setFileError(message) {
      fileError.textContent = message;
      fileError.hidden = false;
      fileInput.setAttribute('aria-invalid', 'true');
    }
    function clearFileError() {
      fileError.textContent = '';
      fileError.hidden = true;
      fileInput.setAttribute('aria-invalid', 'false');
    }

    fileInput.addEventListener('change', () => {
      validateFile();
      updateSubmitState();
    });

    // Description validation
    function validateDescription() {
      const val = descriptionInput.value.trim();
      if (!val) {
        setDescError('Description is required.');
        return false;
      }
      if (val.length > 500) {
        setDescError('Description must be 500 characters or less.');
        return false;
      }
      clearDescError();
      return true;
    }
    function setDescError(message) {
      descError.textContent = message;
      descError.hidden = false;
      descriptionInput.setAttribute('aria-invalid', 'true');
    }
    function clearDescError() {
      descError.textContent = '';
      descError.hidden = true;
      descriptionInput.setAttribute('aria-invalid', 'false');
    }
    descriptionInput.addEventListener('input', () => {
      validateDescription();
      updateSubmitState();
    });

    // Enable submit only if all validations pass
    function updateSubmitState() {
      const validFile = validateFile();
      const validDesc = validateDescription();
      const validTags = validateTags();
      submitButton.disabled = !(validFile && validDesc && validTags);
    }

    // Form submission handler
    uploadForm.addEventListener('submit', e => {
      e.preventDefault();
      updateSubmitState();
      if (submitButton.disabled) {
        statusMessage.textContent = 'Please fix errors before submitting.';
        statusMessage.className = 'error';
        return;
      }
      // Clear status
      statusMessage.textContent = '';
      statusMessage.className = '';

      // Read file and create gallery item
      const file = fileInput.files[0];
      const description = descriptionInput.value.trim();
      const tagsCopy = [...tags];

      const reader = new FileReader();
      reader.onload = () => {
        const dataUrl = reader.result;
        // Create gallery item object
        const item = {
          id: crypto.randomUUID(),
          src: dataUrl,
          description,
          tags: tagsCopy
        };
        galleryItems.push(item);
        renderGallery();
        statusMessage.textContent = 'Your creative work has been shared successfully!';
        statusMessage.className = '';
        // Reset form
        uploadForm.reset();
        tags = [];
        renderTags();
        updateSubmitState();
        fileInput.focus();
      };
      reader.onerror = () => {
        statusMessage.textContent = 'Error reading the file. Please try again.';
        statusMessage.className = 'error';
      };
      reader.readAsDataURL(file);
    });

    // Render gallery
    function renderGallery(filteredItems = null) {
      const itemsToRender = filteredItems ?? galleryItems;
      gallery.innerHTML = '';
      if (itemsToRender.length === 0) {
        gallery.innerHTML = '<p>No creative works found.</p>';
        return;
      }
      itemsToRender.forEach(item => {
        const card = document.createElement('article');
        card.className = 'gallery-item';
        card.setAttribute('tabindex', '0');
        card.setAttribute('aria-label', `Creative work: ${item.description}. Tags: ${item.tags.join(', ')}`);
        const img = document.createElement('img');
        img.src = item.src;
        img.alt = `Image of creative work: ${item.description}`;
        card.appendChild(img);

        const title = document.createElement('h3');
        title.textContent = item.description.length > 50 ? item.description.slice(0, 47) + '...' : item.description;
        card.appendChild(title);

        const desc = document.createElement('p');
        desc.className = 'description';
        desc.textContent = item.description;
        card.appendChild(desc);

        if (item.tags.length > 0) {
          const tagsContainer = document.createElement('div');
          tagsContainer.className = 'tags';
          item.tags.forEach(tag => {
            const tagSpan = document.createElement('span');
            tagSpan.textContent = tag;
            tagsContainer.appendChild(tagSpan);
          });
          card.appendChild(tagsContainer);
        }

        // Remove button for each gallery item (for demonstration, accessibility)
        const removeBtn = document.createElement('button');
        removeBtn.type = 'button';
        removeBtn.className = 'remove-btn';
        removeBtn.textContent = 'Remove';
        removeBtn.setAttribute('aria-label', `Remove creative work: ${item.description}`);
        removeBtn.addEventListener('click', () => {
          const index = galleryItems.findIndex(i => i.id === item.id);
          if (index !== -1) {
            galleryItems.splice(index, 1);
            renderGallery();
            statusMessage.textContent = 'Creative work removed.';
            statusMessage.className = '';
          }
        });
        card.appendChild(removeBtn);

        gallery.appendChild(card);
      });
    }

    // Search functionality
    searchInput.addEventListener('input', () => {
      const query = searchInput.value.trim().toLowerCase();
      if (!query) {
        renderGallery();
        return;
      }
      const filtered = galleryItems.filter(item => {
        const descMatch = item.description.toLowerCase().includes(query);
        const tagsMatch = item.tags.some(tag => tag.includes(query));
        return descMatch || tagsMatch;
      });
      renderGallery(filtered);
    });

    // Initialize
    renderTags();
    updateSubmitState();
    renderGallery();

    // Accessibility: Trap focus in open submenu (optional enhancement)
    // Reduced motion respect
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)');
    if (prefersReducedMotion.matches) {
      // Disable any animations (none here except menu max-height transitions)
      const styleSheet = document.createElement('style');
      styleSheet.textContent = `
        nav[aria-label="Primary"] ul {
          transition: none !important;
        }
        .submenu {
          transition: none !important;
        }
      `;
      document.head.appendChild(styleSheet);
    }

    // Polyfill for crypto.randomUUID if needed
    if (!crypto.randomUUID) {
      crypto.randomUUID = function() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
          const r = Math.random() * 16 | 0;
          const v = c === 'x' ? r : (r & 0x3 | 0x8);
          return v.toString(16);
        });
      };
    }

  })();
</script>

<!-- Visually hidden class for accessibility -->
<style>
  .visually-hidden {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0 0 0 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
  }
</style>
</body>
</html>