<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Travel Map - Share Your Journey</title>
    <style>
        /* Base Styles with Enhanced Accessibility */
        :root {
            --primary-color: #1a5f7a;
            --primary-dark: #0d3b4d;
            --secondary-color: #f39c12;
            --secondary-dark: #b67509;
            --text-color: #0f172a;
            --background-color: #f8fafc;
            --light-color: #ffffff;
            --error-color: #c0392b;
            --success-color: #27ae60;
            --focus-color: #2563eb;
            --border-color: #64748b;
            --card-background: #ffffff;
        }

        /* Respect user preference for reduced motion */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.001ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.001ms !important;
                scroll-behavior: auto !important;
            }
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
            padding: 0;
            margin: 0;
            min-height: 100vh;
            /* Enhanced text readability per WCAG 2.2 AAA */
            line-height: 1.8;
            letter-spacing: 0.01em;
            word-spacing: 0.05em;
        }

        /* Skip link for keyboard navigation */
        .skip-link {
            position: absolute;
            top: -50px;
            left: 0;
            background: var(--focus-color);
            color: white;
            padding: 12px 20px;
            z-index: 1000;
            font-weight: bold;
            text-decoration: none;
            transition: top 0.3s ease;
            border-radius: 0 0 8px 0;
        }

        .skip-link:focus {
            top: 0;
            outline: 3px solid var(--focus-color);
            outline-offset: 2px;
        }

        /* Enhanced focus styles for all interactive elements */
        a:focus,
        button:focus,
        input:focus,
        select:focus,
        textarea:focus,
        [tabindex]:focus {
            outline: 3px solid var(--focus-color);
            outline-offset: 3px;
            box-shadow: 0 0 0 2px white, 0 0 0 5px var(--focus-color);
        }

        /* Header Styles */
        header {
            background: var(--primary-color);
            color: var(--light-color);
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Main Content */
        main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Map Container */
        .map-container {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        @media (min-width: 992px) {
            .map-container {
                flex-direction: row;
            }
        }

        /* Map Display */
        .map-display {
            flex: 2;
            border: 3px solid var(--primary-color);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            min-height: 500px;
            background-color: #e5f2f8;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .map {
            width: 100%;
            height: 100%;
            min-height: 500px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23c8e6f0"/><path d="M0,0 L100,100 M100,0 L0,100" stroke="%23a7d4e2" stroke-width="0.5"/></svg>');
            position: relative;
            cursor: crosshair;
        }

        .map-pin {
            position: absolute;
            width: 44px;
            height: 44px;
            transform: translate(-50%, -100%);
            cursor: pointer;
            z-index: 10;
            background: none;
            border: none;
            padding: 0;
        }

        .map-pin svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 3px 3px rgba(0, 0, 0, 0.3));
        }

        .map-pin:hover svg,
        .map-pin:focus svg {
            transform: scale(1.1);
        }

        .map-pin .pin-label {
            position: absolute;
            background: var(--primary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .map-pin:hover .pin-label,
        .map-pin:focus .pin-label {
            opacity: 1;
        }

        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }

        .map-controls button {
            display: block;
            width: 44px;
            height: 44px;
            margin: 5px 0;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .map-controls button:hover,
        .map-controls button:focus {
            background: var(--primary-dark);
        }

        .map-legend {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: white;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }

        .map-legend h3 {
            margin-bottom: 8px;
            font-size: 16px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            border-radius: 4px;
        }

        /* Forms and Panels */
        .control-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .panel {
            background: var(--card-background);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
        }

        .panel h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 0.5rem;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.2rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: var(--text-color);
        }

        input[type="text"],
        input[type="date"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
            background-color: var(--light-color);
            color: var(--text-color);
            min-height: 44px; /* AAA compliance for touch targets */
        }

        input[type="text"]:focus,
        input[type="date"]:focus,
        textarea:focus,
        select:focus {
            border-color: var(--focus-color);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .required-field::after {
            content: " *";
            color: var(--error-color);
        }

        .form-help {
            display: block;
            margin-top: 0.3rem;
            font-size: 0.9rem;
            color: #555;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            min-height: 44px;
            min-width: 44px;
            font-weight: bold;
        }

        button:hover,
        button:focus {
            background-color: var(--primary-dark);
        }

        button.secondary {
            background-color: var(--secondary-color);
        }

        button.secondary:hover,
        button.secondary:focus {
            background-color: var(--secondary-dark);
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        /* Experience List */
        .experience-list {
            list-style: none;
            margin-top: 1rem;
        }

        .experience-item {
            background: var(--light-color);
            border-left: 4px solid var(--secondary-color);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0 4px 4px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .experience-item h3 {
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .experience-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .experience-actions {
            margin-top: 0.5rem;
            display: flex;
            gap: 0.5rem;
        }

        .experience-actions button {
            padding: 6px 12px;
            font-size: 0.9rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            width: 90%;
            max-width: 600px;
            border-radius: 8px;
            padding: 2rem;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            min-width: 44px;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal h2 {
            margin-bottom: 1.5rem;
            color: var(--primary-color);
        }

        /* Status Messages */
        .status-message {
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            font-weight: bold;
            display: none;
        }

        .status-message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .status-message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        /* Footer */
        footer {
            background: var(--primary-color);
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
        }

        footer p {
            max-width: 800px;
            margin: 0 auto 1rem;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1rem;
        }

        .footer-links a {
            color: white;
            text-decoration: none;
            font-weight: bold;
        }

        .footer-links a:hover,
        .footer-links a:focus {
            text-decoration: underline;
        }

        /* Accessibility Enhancements */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            main {
                padding: 1rem;
            }

            .button-group {
                flex-direction: column;
            }

            .map-display {
                min-height: 400px;
            }

            .map {
                min-height: 400px;
            }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <header>
        <h1>Interactive Travel Map</h1>
        <p>Pin your adventures, share your experiences, and explore the world through others' journeys</p>
    </header>

    <main id="main-content">
        <div class="map-container">
            <div class="map-display" aria-label="Interactive travel map">
                <div id="map" class="map" tabindex="0" aria-label="Map where you can add pins by clicking" role="application">
                    <!-- Map pins will be added here dynamically -->
                </div>
                <div class="map-controls" aria-label="Map controls">
                    <button id="zoom-in" aria-label="Zoom in">
                        <span aria-hidden="true">+</span>
                    </button>
                    <button id="zoom-out" aria-label="Zoom out">
                        <span aria-hidden="true">-</span>
                    </button>
                    <button id="reset-map" aria-label="Reset map view">
                        <span aria-hidden="true">↺</span>
                    </button>
                </div>
                <div class="map-legend">
                    <h3>Map Legend</h3>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #e74c3c;"></div>
                        <span>Your pins</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #3498db;"></div>
                        <span>Community pins</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #2ecc71;"></div>
                        <span>Featured destinations</span>
                    </div>
                </div>
            </div>

            <div class="control-panel">
                <section class="panel" aria-labelledby="add-location-heading">
                    <h2 id="add-location-heading">Add New Location</h2>
                    <div id="status-message" class="status-message" role="status" aria-live="polite"></div>
                    <form id="location-form">
                        <div class="form-group">
                            <label for="location-name" class="required-field">Location Name</label>
                            <input 
                                type="text" 
                                id="location-name" 
                                name="location-name" 
                                required 
                                aria-required="true"
                                autocomplete="off"
                            >
                            <span id="location-name-help" class="form-help">Enter the name of the place you visited</span>
                        </div>

                        <div class="form-group">
                            <label for="location-country" class="required-field">Country</label>
                            <input 
                                type="text" 
                                id="location-country" 
                                name="location-country" 
                                required 
                                aria-required="true"
                                autocomplete="country-name"
                            >
                        </div>

                        <div class="form-group">
                            <label for="visit-date" class="required-field">Date of Visit</label>
                            <input 
                                type="date" 
                                id="visit-date" 
                                name="visit-date" 
                                required 
                                aria-required="true"
                            >
                        </div>

                        <div class="form-group">
                            <label for="experience-type">Type of Experience</label>
                            <select id="experience-type" name="experience-type">
                                <option value="sightseeing">Sightseeing</option>
                                <option value="food">Food & Cuisine</option>
                                <option value="adventure">Adventure</option>
                                <option value="relaxation">Relaxation</option>
                                <option value="cultural">Cultural</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="experience-description" class="required-field">Your Experience</label>
                            <textarea 
                                id="experience-description" 
                                name="experience-description" 
                                required 
                                aria-required="true"
                                aria-describedby="description-help"
                            ></textarea>
                            <span id="description-help" class="form-help">Share your experience, recommendations, or tips about this location</span>
                        </div>

                        <div class="form-group">
                            <fieldset>
                                <legend>Rating</legend>
                                <div style="display: flex; gap: 1rem;">
                                    <div>
                                        <input type="radio" id="rating-5" name="rating" value="5" checked>
                                        <label for="rating-5">5 - Excellent</label>
                                    </div>
                                    <div>
                                        <input type="radio" id="rating-4" name="rating" value="4">
                                        <label for="rating-4">4 - Very Good</label>
                                    </div>
                                    <div>
                                        <input type="radio" id="rating-3" name="rating" value="3">
                                        <label for="rating-3">3 - Good</label>
                                    </div>
                                    <div>
                                        <input type="radio" id="rating-2" name="rating" value="2">
                                        <label for="rating-2">2 - Fair</label>
                                    </div>
                                    <div>
                                        <input type="radio" id="rating-1" name="rating" value="1">
                                        <label for="rating-1">1 - Poor</label>
                                    </div>
                                </div>
                            </fieldset>
                        </div>

                        <div class="button-group">
                            <button type="submit" id="add-location-btn">Add to Map</button>
                            <button type="reset" class="secondary">Clear Form</button>
                        </div>
                    </form>
                </section>

                <section class="panel" aria-labelledby="experiences-heading">
                    <h2 id="experiences-heading">Your Travel Experiences</h2>
                    <p>Click on a location on the map to add a pin, or browse your saved experiences below.</p>
                    
                    <ul id="experience-list" class="experience-list" aria-label="List of your travel experiences">
                        <!-- Experience items will be added here dynamically -->
                        <li class="experience-item">
                            <h3>Paris, France</h3>
                            <div class="experience-meta">
                                <span>Visited: June 15, 2023</span>
                                <span>Type: Cultural</span>
                            </div>
                            <p>Explored the Louvre and saw the Mona Lisa. The city's architecture is breathtaking, especially Notre-Dame Cathedral despite the reconstruction. Enjoyed authentic French pastries at a local café.</p>
                            <div class="experience-actions">
                                <button class="view-on-map-btn" aria-label="View Paris on map">View on Map</button>
                                <button class="edit-experience-btn" aria-label="Edit Paris experience">Edit</button>
                                <button class="delete-experience-btn" aria-label="Delete Paris experience">Delete</button>
                            </div>
                        </li>
                        <li class="experience-item">
                            <h3>Kyoto, Japan</h3>
                            <div class="experience-meta">
                                <span>Visited: November 10, 2022</span>
                                <span>Type: Cultural</span>
                            </div>
                            <p>Visited during autumn when the maple leaves were changing colors. The Fushimi Inari Shrine with its thousands of torii gates was a highlight. Tried traditional Japanese tea ceremony.</p>
                            <div class="experience-actions">
                                <button class="view-on-map-btn" aria-label="View Kyoto on map">View on Map</button>
                                <button class="edit-experience-btn" aria-label="Edit Kyoto experience">Edit</button>
                                <button class="delete-experience-btn" aria-label="Delete Kyoto experience">Delete</button>
                            </div>
                        </li>
                    </ul>
                </section>
            </div>
        </div>
    </main>

    <!-- Modal for viewing/editing experiences -->
    <div id="experience-modal" class="modal-overlay" aria-hidden="true">
        <div class="modal" role="dialog" aria-labelledby="modal-title" aria-modal="true">
            <button id="modal-close" class="modal-close" aria-label="Close modal">×</button>
            <h2 id="modal-title">Location Details</h2>
            <div id="modal-content">
                <!-- Modal content will be populated dynamically -->
            </div>
        </div>
    </div>

    <footer>
        <p>Interactive Travel Map - Share your journeys with the world</p>
        <p>This application allows you to pin locations on the map and share your travel experiences with others.</p>
        <div class="footer-links">
            <a href="#" aria-label="About this project">About</a>
            <a href="#" aria-label="Privacy policy">Privacy</a>
            <a href="#" aria-label="Terms of service">Terms</a>
            <a href="#" aria-label="Contact us">Contact</a>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const map = document.getElementById('map');
            const locationForm = document.getElementById('location-form');
            const statusMessage = document.getElementById('status-message');
            const experienceList = document.getElementById('experience-list');
            const modal = document.getElementById('experience-modal');
            const modalClose = document.getElementById('modal-close');
            const modalContent = document.getElementById('modal-content');
            const zoomInBtn = document.getElementById('zoom-in');
            const zoomOutBtn = document.getElementById('zoom-out');
            const resetMapBtn = document.getElementById('reset-map');

            // Map state
            let mapScale = 1;
            let mapTranslateX = 0;
            let mapTranslateY = 0;
            let isDragging = false;
            let dragStartX = 0;
            let dragStartY = 0;
            let currentPinId = 0;
            let pins = [
                { id: 'pin-1', x: 200, y: 150, title: 'Paris, France', date: '2023-06-15', type: 'Cultural', description: 'Explored the Louvre and saw the Mona Lisa. The city\'s architecture is breathtaking, especially Notre-Dame Cathedral despite the reconstruction. Enjoyed authentic French pastries at a local café.', rating: 5, color: '#e74c3c' },
                { id: 'pin-2', x: 650, y: 200, title: 'Kyoto, Japan', date: '2022-11-10', type: 'Cultural', description: 'Visited during autumn when the maple leaves were changing colors. The Fushimi Inari Shrine with its thousands of torii gates was a highlight. Tried traditional Japanese tea ceremony.', rating: 5, color: '#e74c3c' }
            ];

            // Initialize map
            function initMap() {
                // Add existing pins to the map
                pins.forEach(pin => {
                    addPinToMap(pin);
                });

                // Map click event to add new pins
                map.addEventListener('click', function(e) {
                    if (e.target === map) {
                        const rect = map.getBoundingClientRect();
                        const x = (e.clientX - rect.left) / mapScale - mapTranslateX;
                        const y = (e.clientY - rect.top) / mapScale - mapTranslateY;
                        
                        // Show form and focus on location name input
                        document.getElementById('location-name').focus();
                        
                        // Store coordinates for form submission
                        map.dataset.pendingX = x;
                        map.dataset.pendingY = y;
                        
                        // Show status message
                        showStatus('Click "Add to Map" to save this location', 'success');
                    }
                });

                // Map dragging functionality
                map.addEventListener('mousedown', startDrag);
                map.addEventListener('touchstart', handleTouchStart);
                
                document.addEventListener('mousemove', drag);
                document.addEventListener('touchmove', handleTouchMove);
                
                document.addEventListener('mouseup', endDrag);
                document.addEventListener('touchend', endDrag);

                // Map control buttons
                zoomInBtn.addEventListener('click', zoomIn);
                zoomOutBtn.addEventListener('click', zoomOut);
                resetMapBtn.addEventListener('click', resetMap);

                // Keyboard controls for map
                map.addEventListener('keydown', handleMapKeyboard);
            }

            // Add a pin to the map
            function addPinToMap(pin) {
                const pinElement = document.createElement('button');
                pinElement.className = 'map-pin';
                pinElement.id = pin.id;
                pinElement.style.left = `${pin.x}px`;
                pinElement.style.top = `${pin.y}px`;
                pinElement.setAttribute('aria-label', `Pin for ${pin.title}`);
                pinElement.setAttribute('data-title', pin.title);
                pinElement.setAttribute('data-date', pin.date);
                pinElement.setAttribute('data-type', pin.type);
                pinElement.setAttribute('data-description', pin.description);
                pinElement.setAttribute('data-rating', pin.rating);
                
                // Pin SVG with dynamic color
                pinElement.innerHTML = `
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 0C7.31 0 3.5 3.81 3.5 8.5C3.5 14.92 12 24 12 24C12 24 20.5 14.92 20.5 8.5C20.5 3.81 16.69 0 12 0ZM12 13C9.52 13 7.5 10.98 7.5 8.5C7.5 6.02 9.52 4 12 4C14.48 4 16.5 6.02 16.5 8.5C16.5 10.98 14.48 13 12 13Z" fill="${pin.color || '#e74c3c'}"/>
                    </svg>
                    <span class="pin-label">${pin.title}</span>
                `;
                
                // Pin click event
                pinElement.addEventListener('click', function(e) {
                    e.stopPropagation();
                    openPinModal(pin);
                });
                
                map.appendChild(pinElement);
            }

            // Form submission to add a new location
            locationForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get form values
                const name = document.getElementById('location-name').value;
                const country = document.getElementById('location-country').value;
                const date = document.getElementById('visit-date').value;
                const type = document.getElementById('experience-type').value;
                const description = document.getElementById('experience-description').value;
                const rating = document.querySelector('input[name="rating"]:checked').value;
                
                // Validate form
                if (!name || !country || !date || !description) {
                    showStatus('Please fill out all required fields', 'error');
                    return;
                }
                
                // Get coordinates from map click or use default
                const x = parseFloat(map.dataset.pendingX) || 300 + Math.random() * 200;
                const y = parseFloat(map.dataset.pendingY) || 200 + Math.random() * 100;
                
                // Create new pin
                currentPinId++;
                const newPin = {
                    id: `pin-${currentPinId}`,
                    x: x,
                    y: y,
                    title: `${name}, ${country}`,
                    date: date,
                    type: type,
                    description: description,
                    rating: rating,
                    color: '#e74c3c'
                };
                
                // Add pin to map and list
                pins.push(newPin);
                addPinToMap(newPin);
                addExperienceToList(newPin);
                
                // Reset form and show success message
                locationForm.reset();
                delete map.dataset.pendingX;
                delete map.dataset.pendingY;
                
                showStatus('Location added successfully!', 'success');
            });

            // Add experience to the list
            function addExperienceToList(pin) {
                const listItem = document.createElement('li');
                listItem.className = 'experience-item';
                listItem.setAttribute('data-pin-id', pin.id);
                
                // Format date for display
                const displayDate = new Date(pin.date).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                listItem.innerHTML = `
                    <h3>${pin.title}</h3>
                    <div class="experience-meta">
                        <span>Visited: ${displayDate}</span>
                        <span>Type: ${pin.type}</span>
                    </div>
                    <p>${pin.description}</p>
                    <div class="experience-actions">
                        <button class="view-on-map-btn" aria-label="View ${pin.title} on map">View on Map</button>
                        <button class="edit-experience-btn" aria-label="Edit ${pin.title} experience">Edit</button>
                        <button class="delete-experience-btn" aria-label="Delete ${pin.title} experience">Delete</button>
                    </div>
                `;
                
                // Add event listeners to buttons
                listItem.querySelector('.view-on-map-btn').addEventListener('click', function() {
                    focusOnPin(pin.id);
                });
                
                listItem.querySelector('.edit-experience-btn').addEventListener('click', function() {
                    openPinModal(pin, true);
                });
                
                listItem.querySelector('.delete-experience-btn').addEventListener('click', function() {
                    deletePin(pin.id);
                });
                
                experienceList.prepend(listItem);
            }

            // Focus on a specific pin
            function focusOnPin(pinId) {
                const pin = document.getElementById(pinId);
                if (pin) {
                    const pinX = parseFloat(pin.style.left);
                    const pinY = parseFloat(pin.style.top);
                    
                    // Center map on pin
                    const mapWidth = map.clientWidth;
                    const mapHeight = map.clientHeight;
                    
                    mapTranslateX = (mapWidth / 2 / mapScale) - pinX;
                    mapTranslateY = (mapHeight / 2 / mapScale) - pinY;
                    
                    updateMapTransform();
                    
                    // Highlight pin
                    pin.focus();
                    
                    // Announce to screen readers
                    showStatus(`Map centered on ${pin.getAttribute('data-title')}`, 'success');
                }
            }

            // Delete a pin
            function deletePin(pinId) {
                if (confirm('Are you sure you want to delete this location?')) {
                    // Remove pin from map
                    const pinElement = document.getElementById(pinId);
                    if (pinElement) {
                        pinElement.remove();
                    }
                    
                    // Remove from pins array
                    pins = pins.filter(pin => pin.id !== pinId);
                    
                    // Remove from experience list
                    const listItem = experienceList.querySelector(`[data-pin-id="${pinId}"]`);
                    if (listItem) {
                        listItem.remove();
                    }
                    
                    showStatus('Location deleted successfully', 'success');
                }
            }

            // Open modal with pin details
            function openPinModal(pin, isEditing = false) {
                const pinElement = document.getElementById(pin.id);
                const title = pinElement ? pinElement.getAttribute('data-title') : pin.title;
                const date = pinElement ? pinElement.getAttribute('data-date') : pin.date;
                const type = pinElement ? pinElement.getAttribute('data-type') : pin.type;
                const description = pinElement ? pinElement.getAttribute('data-description') : pin.description;
                const rating = pinElement ? pinElement.getAttribute('data-rating') : pin.rating;
                
                // Set modal title
                document.getElementById('modal-title').textContent = isEditing ? `Edit ${title}` : title;
                
                // Format date for display
                const displayDate = new Date(date).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                if (isEditing) {
                    // Show edit form
                    modalContent.innerHTML = `
                        <form id="edit-location-form">
                            <input type="hidden" id="edit-pin-id" value="${pin.id}">
                            
                            <div class="form-group">
                                <label for="edit-location-name" class="required-field">Location Name</label>
                                <input 
                                    type="text" 
                                    id="edit-location-name" 
                                    name="edit-location-name" 
                                    value="${title.split(',')[0]}" 
                                    required 
                                    aria-required="true"
                                >
                            </div>
                            
                            <div class="form-group">
                                <label for="edit-location-country" class="required-field">Country</label>
                                <input 
                                    type="text" 
                                    id="edit-location-country" 
                                    name="edit-location-country" 
                                    value="${title.split(',')[1] ? title.split(',')[1].trim() : ''}" 
                                    required 
                                    aria-required="true"
                                    autocomplete="country-name"
                                >
                            </div>
                            
                            <div class="form-group">
                                <label for="edit-visit-date" class="required-field">Date of Visit</label>
                                <input 
                                    type="date" 
                                    id="edit-visit-date" 
                                    name="edit-visit-date" 
                                    value="${date}" 
                                    required 
                                    aria-required="true"
                                >
                            </div>
                            
                            <div class="form-group">
                                <label for="edit-experience-type">Type of Experience</label>
                                <select id="edit-experience-type" name="edit-experience-type">
                                    <option value="sightseeing" ${type === 'sightseeing' ? 'selected' : ''}>Sightseeing</option>
                                    <option value="food" ${type === 'food' ? 'selected' : ''}>Food & Cuisine</option>
                                    <option value="adventure" ${type === 'adventure' ? 'selected' : ''}>Adventure</option>
                                    <option value="relaxation" ${type === 'relaxation' ? 'selected' : ''}>Relaxation</option>
                                    <option value="cultural" ${type === 'cultural' ? 'selected' : ''}>Cultural</option>
                                    <option value="other" ${type === 'other' ? 'selected' : ''}>Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="edit-experience-description" class="required-field">Your Experience</label>
                                <textarea 
                                    id="edit-experience-description" 
                                    name="edit-experience-description" 
                                    required 
                                    aria-required="true"
                                >${description}</textarea>
                            </div>
                            
                            <div class="form-group">
                                <fieldset>
                                    <legend>Rating</legend>
                                    <div style="display: flex; gap: 1rem;">
                                        <div>
                                            <input type="radio" id="edit-rating-5" name="edit-rating" value="5" ${rating == 5 ? 'checked' : ''}>
                                            <label for="edit-rating-5">5 - Excellent</label>
                                        </div>
                                        <div>
                                            <input type="radio" id="edit-rating-4" name="edit-rating" value="4" ${rating == 4 ? 'checked' : ''}>
                                            <label for="edit-rating-4">4 - Very Good</label>
                                        </div>
                                        <div>
                                            <input type="radio" id="edit-rating-3" name="edit-rating" value="3" ${rating == 3 ? 'checked' : ''}>
                                            <label for="edit-rating-3">3 - Good</label>
                                        </div>
                                        <div>
                                            <input type="radio" id="edit-rating-2" name="edit-rating" value="2" ${rating == 2 ? 'checked' : ''}>
                                            <label for="edit-rating-2">2 - Fair</label>
                                        </div>
                                        <div>
                                            <input type="radio" id="edit-rating-1" name="edit-rating" value="1" ${rating == 1 ? 'checked' : ''}>
                                            <label for="edit-rating-1">1 - Poor</label>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                            
                            <div class="button-group">
                                <button type="submit" id="save-edit-btn">Save Changes</button>
                                <button type="button" id="cancel-edit-btn" class="secondary">Cancel</button>
                            </div>
                        </form>
                    `;
                    
                    // Add event listeners to form buttons
                    document.getElementById('edit-location-form').addEventListener('submit', function(e) {
                        e.preventDefault();
                        saveEditedPin(pin.id);
                    });
                    
                    document.getElementById('cancel-edit-btn').addEventListener('click', function() {
                        closeModal();
                    });
                } else {
                    // Show pin details
                    modalContent.innerHTML = `
                        <div class="pin-details">
                            <p><strong>Location:</strong> ${title}</p>
                            <p><strong>Visited:</strong> ${displayDate}</p>
                            <p><strong>Experience Type:</strong> ${type}</p>
                            <p><strong>Rating:</strong> ${getRatingStars(rating)}</p>
                            <h3>Experience:</h3>
                            <p>${description}</p>
                            
                            <div class="button-group">
                                <button id="edit-this-pin-btn">Edit</button>
                                <button id="delete-this-pin-btn" class="secondary">Delete</button>
                            </div>
                        </div>
                    `;
                    
                    // Add event listeners to buttons
                    document.getElementById('edit-this-pin-btn').addEventListener('click', function() {
                        openPinModal(pin, true);
                    });
                    
                    document.getElementById('delete-this-pin-btn').addEventListener('click', function() {
                        closeModal();
                        deletePin(pin.id);
                    });
                }
                
                // Show modal
                modal.classList.add('active');
                modal.setAttribute('aria-hidden', 'false');
                
                // Set focus to first focusable element
                const firstFocusable = modal.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                if (firstFocusable) {
                    firstFocusable.focus();
                }
                
                // Store the element that had focus before the modal opened
                modal.dataset.previousFocus = document.activeElement.id || 'map';
            }

            // Save edited pin
            function saveEditedPin(pinId) {
                const name = document.getElementById('edit-location-name').value;
                const country = document.getElementById('edit-location-country').value;
                const date = document.getElementById('edit-visit-date').value;
                const type = document.getElementById('edit-experience-type').value;
                const description = document.getElementById('edit-experience-description').value;
                const rating = document.querySelector('input[name="edit-rating"]:checked').value;
                
                // Validate form
                if (!name || !country || !date || !description) {
                    alert('Please fill out all required fields');
                    return;
                }
                
                // Update pin data
                const title = `${name}, ${country}`;
                const pinIndex = pins.findIndex(pin => pin.id === pinId);
                
                if (pinIndex !== -1) {
                    pins[pinIndex].title = title;
                    pins[pinIndex].date = date;
                    pins[pinIndex].type = type;
                    pins[pinIndex].description = description;
                    pins[pinIndex].rating = rating;
                    
                    // Update pin element
                    const pinElement = document.getElementById(pinId);
                    if (pinElement) {
                        pinElement.setAttribute('data-title', title);
                        pinElement.setAttribute('data-date', date);
                        pinElement.setAttribute('data-type', type);
                        pinElement.setAttribute('data-description', description);
                        pinElement.setAttribute('data-rating', rating);
                        pinElement.setAttribute('aria-label', `Pin for ${title}`);
                        
                        // Update pin label
                        const pinLabel = pinElement.querySelector('.pin-label');
                        if (pinLabel) {
                            pinLabel.textContent = title;
                        }
                    }
                    
                    // Update experience list item
                    const listItem = experienceList.querySelector(`[data-pin-id="${pinId}"]`);
                    if (listItem) {
                        // Format date for display
                        const displayDate = new Date(date).toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        });
                        
                        listItem.querySelector('h3').textContent = title;
                        listItem.querySelector('.experience-meta').innerHTML = `
                            <span>Visited: ${displayDate}</span>
                            <span>Type: ${type}</span>
                        `;
                        listItem.querySelector('p').textContent = description;
                        
                        // Update button labels
                        listItem.querySelector('.view-on-map-btn').setAttribute('aria-label', `View ${title} on map`);
                        listItem.querySelector('.edit-experience-btn').setAttribute('aria-label', `Edit ${title} experience`);
                        listItem.querySelector('.delete-experience-btn').setAttribute('aria-label', `Delete ${title} experience`);
                    }
                    
                    closeModal();
                    showStatus('Location updated successfully', 'success');
                }
            }

            // Close modal
            function closeModal() {
                modal.classList.remove('active');
                modal.setAttribute('aria-hidden', 'true');
                
                // Return focus to the element that had focus before the modal opened
                const previousFocusId = modal.dataset.previousFocus || 'map';
                const previousFocusElement = document.getElementById(previousFocusId) || document.getElementById('map');
                if (previousFocusElement) {
                    previousFocusElement.focus();
                }
            }

            // Modal close button
            modalClose.addEventListener('click', closeModal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal();
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal.classList.contains('active')) {
                    closeModal();
                }
            });

            // Map dragging functions
            function startDrag(e) {
                if (e.target === map) {
                    isDragging = true;
                    dragStartX = e.clientX;
                    dragStartY = e.clientY;
                    map.style.cursor = 'grabbing';
                }
            }

            function handleTouchStart(e) {
                if (e.target === map && e.touches.length === 1) {
                    isDragging = true;
                    dragStartX = e.touches[0].clientX;
                    dragStartY = e.touches[0].clientY;
                }
            }

            function drag(e) {
                if (!isDragging) return;
                
                const dx = (e.clientX - dragStartX) / mapScale;
                const dy = (e.clientY - dragStartY) / mapScale;
                
                mapTranslateX += dx;
                mapTranslateY += dy;
                
                updateMapTransform();
                
                dragStartX = e.clientX;
                dragStartY = e.clientY;
            }

            function handleTouchMove(e) {
                if (!isDragging || e.touches.length !== 1) return;
                
                const dx = (e.touches[0].clientX - dragStartX) / mapScale;
                const dy = (e.touches[0].clientY - dragStartY) / mapScale;
                
                mapTranslateX += dx;
                mapTranslateY += dy;
                
                updateMapTransform();
                
                dragStartX = e.touches[0].clientX;
                dragStartY = e.touches[0].clientY;
                
                // Prevent page scrolling while dragging map
                e.preventDefault();
            }

            function endDrag() {
                isDragging = false;
                map.style.cursor = 'crosshair';
            }

            // Map zoom functions
            function zoomIn() {
                mapScale = Math.min(mapScale * 1.2, 5);
                updateMapTransform();
                announceZoomLevel();
            }

            function zoomOut() {
                mapScale = Math.max(mapScale / 1.2, 0.5);
                updateMapTransform();
                announceZoomLevel();
            }

            function resetMap() {
                mapScale = 1;
                mapTranslateX = 0;
                mapTranslateY = 0;
                updateMapTransform();
                showStatus('Map view reset', 'success');
            }

            function updateMapTransform() {
                map.style.transform = `scale(${mapScale}) translate(${mapTranslateX}px, ${mapTranslateY}px)`;
            }

            function announceZoomLevel() {
                const zoomPercent = Math.round(mapScale * 100);
                showStatus(`Map zoom level: ${zoomPercent}%`, 'success');
            }

            // Keyboard navigation for map
            function handleMapKeyboard(e) {
                // Only handle keyboard events when map has focus
                if (document.activeElement !== map) return;
                
                const step = 50 / mapScale;
                
                switch (e.key) {
                    case 'ArrowUp':
                        mapTranslateY += step;
                        e.preventDefault();
                        break;
                    case 'ArrowDown':
                        mapTranslateY -= step;
                        e.preventDefault();
                        break;
                    case 'ArrowLeft':
                        mapTranslateX += step;
                        e.preventDefault();
                        break;
                    case 'ArrowRight':
                        mapTranslateX -= step;
                        e.preventDefault();
                        break;
                    case '+':
                        zoomIn();
                        e.preventDefault();
                        break;
                    case '-':
                        zoomOut();
                        e.preventDefault();
                        break;
                    case 'Home':
                        resetMap();
                        e.preventDefault();
                        break;
                }
                
                updateMapTransform();
            }

            // Helper functions
            function showStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.className = `status-message ${type}`;
                
                // Clear status after 5 seconds
                setTimeout(() => {
                    statusMessage.className = 'status-message';
                }, 5000);
            }

            function getRatingStars(rating) {
                const fullStar = '★';
                const emptyStar = '☆';
                const stars = fullStar.repeat(rating) + emptyStar.repeat(5 - rating);
                return stars;
            }

            // Initialize existing experiences
            function initExperiences() {
                // Clear existing list items
                experienceList.innerHTML = '';
                
                // Add pins to experience list
                pins.forEach(pin => {
                    addExperienceToList(pin);
                });
            }

            // Initialize the application
            initMap();
            initExperiences();
        });
    </script>
</body>
</html>