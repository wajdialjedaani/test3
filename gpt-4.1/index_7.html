<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Accessible Color Mixer & Custom Palette Creator – Real-Time Theme Preview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Mix colors, create accessible custom palettes, and preview high-contrast, colorful design themes in real time. Fully WCAG 2.2 AAA compliant.">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32'><rect width='32' height='32' rx='8' fill='%230095a8'/><circle cx='16' cy='16' r='10' fill='%23fff'/></svg>">
  <style>
    :root {
      --focus-color: #FFD600;
      --focus-outline: 3px solid var(--focus-color);
      --font-size-base: 1.125rem;
      --line-height-base: 1.7;
      --heading-color: #222;
      --main-bg: #fff;
      --main-fg: #1a1a1a;
      --accent1: #005A9E;
      --accent2: #F25F5C;
      --accent3: #70C1B3;
      --accent4: #FFE066;
      --accent5: #247BA0;
      --contrast-black: #000;
      --contrast-white: #fff;
      --error: #B00020;
      --success: #007E33;
      --help-bg: #f2f2f7;
      --help-fg: #222;
      --border-radius: 0.5rem;
      --transition: 0.15s cubic-bezier(.4,0,.2,1);
      --min-touch: 44px;
      --palette-card-shadow: 0 2px 8px 0 rgba(0,0,0,0.07);
      --focus-indicator-thickness: 3px;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --main-bg: #111;
        --main-fg: #f7f7f7;
        --heading-color: #fff;
        --help-bg: #222;
        --help-fg: #f7f7f7;
      }
    }

    @media (prefers-reduced-motion: reduce) {
      * {
        transition: none !important;
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
      }
    }

    html {
      font-size: 18px;
      background: linear-gradient(135deg, var(--accent1) 0%, var(--accent3) 100%);
      min-height: 100%;
      color-scheme: light dark;
    }
    body {
      background: var(--main-bg);
      color: var(--main-fg);
      font-family: 'Segoe UI', Arial, sans-serif;
      font-size: var(--font-size-base);
      line-height: var(--line-height-base);
      margin: 0;
      min-height: 100vh;
      max-width: 80ch;
      margin-left: auto;
      margin-right: auto;
      padding: 0;
      word-break: break-word;
      box-sizing: border-box;
    }
    a {
      color: var(--accent1);
      text-decoration: underline;
      word-break: break-all;
    }
    a:focus, button:focus, input:focus, select:focus, textarea:focus {
      outline: var(--focus-outline);
      outline-offset: 2px;
      z-index: 2;
    }
    a:active, button:active {
      outline: var(--focus-outline);
    }
    .skip-link {
      position: absolute;
      left: 0;
      top: 0;
      background: var(--accent4);
      color: var(--contrast-black);
      padding: 0.5em 1em;
      z-index: 1000;
      transform: translateY(-120%);
      transition: transform 0.2s;
      font-weight: bold;
      border-radius: 0 0 0.5em 0.5em;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      min-width: var(--min-touch);
      min-height: var(--min-touch);
      display: inline-block;
    }
    .skip-link:focus {
      transform: translateY(0);
    }
    header, nav, main, footer {
      width: 100%;
      max-width: 80ch;
      margin-left: auto;
      margin-right: auto;
    }
    header {
      background: linear-gradient(90deg, var(--accent1) 0%, var(--accent5) 100%);
      color: var(--contrast-white);
      padding: 2rem 1rem 1rem 1rem;
      border-bottom: 6px solid var(--accent4);
      box-shadow: 0 4px 24px rgba(0,0,0,0.06);
    }
    header h1 {
      margin: 0 0 0.5rem 0;
      font-size: 2.3rem;
      line-height: 1.2;
      color: var(--contrast-white);
      text-shadow: 1px 2px 0 rgba(0,0,0,0.18);
      letter-spacing: 0.03em;
    }
    header p {
      margin: 0;
      font-size: 1.25rem;
      color: var(--accent4);
      text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
    }
    nav[aria-label], nav[aria-labelledby] {
      margin-top: 0;
      margin-bottom: 1.5rem;
      background: var(--accent5);
      color: var(--contrast-white);
      padding: 0.5rem 1rem;
      border-radius: 0 0 var(--border-radius) var(--border-radius);
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      display: flex;
      align-items: center;
      gap: 2rem;
      flex-wrap: wrap;
    }
    nav ul {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
    }
    nav li {
      margin: 0;
      padding: 0;
    }
    nav a, nav button {
      background: none;
      border: none;
      color: var(--contrast-white);
      font-weight: bold;
      font-size: 1.1rem;
      padding: 0.5em 1em;
      border-radius: var(--border-radius);
      cursor: pointer;
      min-width: var(--min-touch);
      min-height: var(--min-touch);
      transition: background 0.12s;
      position: relative;
      text-align: left;
      display: inline-block;
    }
    nav a:focus, nav button:focus {
      background: var(--accent4);
      color: var(--contrast-black);
      outline: var(--focus-outline);
    }
    nav a[aria-current="page"], nav button[aria-current="page"] {
      background: var(--accent4);
      color: var(--contrast-black);
      cursor: default;
      pointer-events: none;
    }
    nav .submenu {
      display: none;
      position: absolute;
      left: 0;
      top: 100%;
      background: var(--accent5);
      border-radius: var(--border-radius);
      box-shadow: 0 2px 8px rgba(0,0,0,0.09);
      min-width: 180px;
      z-index: 10;
      padding: 0.5rem 0;
    }
    nav li:focus-within > .submenu,
    nav li:hover > .submenu,
    nav button[aria-expanded="true"] + .submenu {
      display: block;
    }
    nav .submenu a {
      display: block;
      padding: 0.5em 1em;
      color: var(--contrast-white);
      background: none;
      border: none;
      text-align: left;
      min-width: var(--min-touch);
      min-height: var(--min-touch);
    }
    nav .submenu a:focus, nav .submenu a:hover {
      background: var(--accent4);
      color: var(--contrast-black);
      outline: var(--focus-outline);
    }
    .breadcrumb-nav {
      margin: 1rem 0 2rem 0;
      font-size: 1rem;
      background: var(--accent3);
      color: var(--contrast-black);
      border-radius: var(--border-radius);
      padding: 0.5rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    .breadcrumb-nav ol {
      list-style: none;
      display: flex;
      gap: 0.5rem;
      margin: 0;
      padding: 0;
    }
    .breadcrumb-nav li+li:before {
      content: "›";
      margin: 0 0.5em;
      color: var(--accent1);
    }
    .breadcrumb-nav a {
      color: var(--accent1);
      text-decoration: underline;
      background: none;
      padding: 0.1em 0.4em;
      border-radius: 0.2em;
      min-width: var(--min-touch);
      min-height: var(--min-touch);
    }
    .breadcrumb-nav a:focus {
      background: var(--accent4);
      color: var(--contrast-black);
      outline: var(--focus-outline);
    }
    main {
      background: var(--main-bg);
      color: var(--main-fg);
      padding: 2rem 1rem 2rem 1rem;
      border-radius: 0 0 var(--border-radius) var(--border-radius);
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      margin-bottom: 2rem;
      min-height: 44vh;
    }
    section {
      margin-bottom: 2.5rem;
    }
    h2, h3, h4 {
      color: var(--heading-color);
      margin-top: 2rem;
      margin-bottom: 0.5rem;
      line-height: 1.3;
      letter-spacing: 0.01em;
    }
    h2 {
      font-size: 1.6rem;
      margin-top: 0;
    }
    h3 {
      font-size: 1.25rem;
      margin-top: 1.5rem;
    }
    h4 {
      font-size: 1.1rem;
      margin-top: 1.2rem;
    }
    p, ul, ol, dl {
      margin-bottom: 1.2em;
      margin-top: 0;
    }
    ul, ol {
      padding-left: 1.5em;
    }
    .help-text {
      background: var(--help-bg);
      color: var(--help-fg);
      border-left: 6px solid var(--accent3);
      padding: 1em;
      border-radius: var(--border-radius);
      margin-bottom: 1.5rem;
      font-size: 1rem;
      line-height: 1.6;
      box-shadow: 0 1px 4px rgba(0,0,0,0.03);
    }
    .visually-hidden {
      position: absolute !important;
      height: 1px; width: 1px;
      overflow: hidden;
      clip: rect(1px, 1px, 1px, 1px);
      white-space: nowrap;
      border: 0;
      padding: 0;
      margin: 0;
    }
    .color-mixer-form {
      display: flex;
      flex-direction: column;
      gap: 2rem;
      background: linear-gradient(120deg, var(--accent4) 0%, var(--accent3) 100%);
      padding: 2rem 1.5rem;
      border-radius: var(--border-radius);
      box-shadow: 0 2px 12px rgba(0,0,0,0.07);
      margin-bottom: 2rem;
      position: relative;
      z-index: 1;
    }
    .color-mixer-form fieldset {
      border: 2px solid var(--accent1);
      border-radius: var(--border-radius);
      padding: 1.2rem 1rem 1.2rem 1rem;
      margin: 0;
      min-width: 0;
      background: var(--main-bg);
      color: var(--main-fg);
      box-shadow: 0 1px 4px rgba(0,0,0,0.03);
    }
    .color-mixer-form legend {
      font-size: 1.1rem;
      font-weight: bold;
      color: var(--accent1);
      padding: 0 0.6em;
      border-radius: 0.3em;
      background: var(--accent4);
      margin-bottom: 0.7em;
      letter-spacing: 0.02em;
    }
    .color-input-row {
      display: flex;
      align-items: flex-end;
      gap: 2rem;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }
    .color-input-group {
      display: flex;
      flex-direction: column;
      gap: 0.4em;
      min-width: 180px;
      max-width: 250px;
      flex: 1 1 180px;
    }
    .color-input-group label {
      font-weight: 600;
      color: var(--accent1);
      margin-bottom: 0.1em;
    }
    .color-input-group input[type="color"] {
      width: 44px;
      height: 44px;
      border: 2px solid var(--accent1);
      border-radius: 0.4em;
      background: var(--main-bg);
      cursor: pointer;
      min-width: var(--min-touch);
      min-height: var(--min-touch);
      margin-right: 0.5em;
      transition: border-color var(--transition);
    }
    .color-input-group input[type="color"]:focus {
      border-color: var(--focus-color);
      outline: var(--focus-outline);
    }
    .color-input-group input[type="text"] {
      width: 120px;
      padding: 0.5em;
      border: 2px solid var(--accent1);
      border-radius: 0.4em;
      font-size: 1rem;
      background: var(--main-bg);
      color: var(--main-fg);
      transition: border-color var(--transition);
    }
    .color-input-group input[type="text"]:focus {
      border-color: var(--focus-color);
      outline: var(--focus-outline);
    }
    .color-input-group .color-sample {
      display: inline-block;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 2px solid var(--accent1);
      margin-left: 0.3em;
      vertical-align: middle;
      background: repeating-linear-gradient(45deg, var(--main-bg) 0 6px, var(--accent4) 6px 12px);
      position: relative;
    }
    .color-input-group .color-sample[aria-label] {
      outline: none;
      box-shadow: 0 0 0 3px var(--accent3);
    }
    .color-input-row .remove-color-btn {
      background: var(--error);
      color: var(--contrast-white);
      border: none;
      border-radius: var(--border-radius);
      font-weight: bold;
      padding: 0.6em 1.2em;
      min-width: var(--min-touch);
      min-height: var(--min-touch);
      margin-left: 0.5em;
      cursor: pointer;
      transition: background var(--transition);
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    }
    .color-input-row .remove-color-btn:focus {
      background: var(--accent4);
      color: var(--contrast-black);
      outline: var(--focus-outline);
    }
    .add-color-btn {
      background: var(--accent1);
      color: var(--contrast-white);
      border: none;
      border-radius: var(--border-radius);
      font-weight: bold;
      padding: 0.7em 1.5em;
      min-width: var(--min-touch);
      min-height: var(--min-touch);
      margin-top: 0.8em;
      cursor: pointer;
      transition: background var(--transition);
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
      font-size: 1.1rem;
      align-self: flex-start;
    }
    .add-color-btn:focus {
      background: var(--accent4);
      color: var(--contrast-black);
      outline: var(--focus-outline);
    }
    .error-message {
      color: var(--error);
      background: #fff4f4;
      border-left: 5px solid var(--error);
      border-radius: 0.4em;
      padding: 0.7em 1em;
      margin-top: 0.3em;
      font-size: 1rem;
      line-height: 1.5;
      box-shadow: 0 1px 4px rgba(0,0,0,0.02);
    }
    .success-message {
      color: var(--success);
      background: #eaffea;
      border-left: 5px solid var(--success);
      border-radius: 0.4em;
      padding: 0.7em 1em;
      margin-top: 0.3em;
      font-size: 1rem;
      line-height: 1.5;
      box-shadow: 0 1px 4px rgba(0,0,0,0.02);
    }
    .palette-actions {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
      margin-top: 1.2em;
      margin-bottom: 0.5em;
    }
    .palette-actions button, .palette-actions input[type="submit"] {
      background: var(--accent2);
      color: var(--contrast-white);
      border: none;
      border-radius: var(--border-radius);
      font-weight: bold;
      padding: 0.7em 1.5em;
      min-width: var(--min-touch);
      min-height: var(--min-touch);
      font-size: 1.1rem;
      cursor: pointer;
      transition: background var(--transition);
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    }
    .palette-actions button:focus, .palette-actions input[type="submit"]:focus {
      background: var(--accent4);
      color: var(--contrast-black);
      outline: var(--focus-outline);
    }
    .palette-actions .save-palette-btn {
      background: var(--accent1);
    }
    .palette-actions .reset-palette-btn {
      background: var(--accent3);
      color: var(--contrast-black);
    }
    .palette-actions .help-btn {
      background: var(--accent4);
      color: var(--contrast-black);
      border: 2px solid var(--accent1);
      font-size: 1rem;
    }
    .palette-actions .help-btn:focus {
      background: var(--accent1);
      color: var(--contrast-white);
      outline: var(--focus-outline);
    }
    .theme-preview {
      background: var(--main-bg);
      border-radius: var(--border-radius);
      box-shadow: 0 2px 16px rgba(0,0,0,0.09);
      padding: 2rem 1.5rem;
      margin-bottom: 2rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    .theme-preview h3 {
      margin-top: 0;
      margin-bottom: 0.6em;
    }
    .theme-preview .theme-visuals {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .theme-preview .theme-card {
      flex: 1 1 220px;
      max-width: 300px;
      min-width: 200px;
      background: #f7f7f7;
      border-radius: var(--border-radius);
      box-shadow: var(--palette-card-shadow);
      padding: 1.2rem 1rem;
      margin-bottom: 0.5em;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.7em;
      position: relative;
    }
    .theme-preview .theme-card .theme-title {
      font-weight: bold;
      color: var(--accent1);
      font-size: 1.1rem;
      margin-bottom: 0.4em;
      text-align: center;
    }
    .theme-preview .theme-card .theme-sample {
      width: 100%;
      min-height: 64px;
      border-radius: var(--border-radius);
      margin-bottom: 0.6em;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      font-weight: 600;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
      border: 2px solid var(--accent1);
      color: var(--contrast-black);
      letter-spacing: 0.01em;
      overflow: hidden;
    }
    .theme-preview .theme-card .theme-desc {
      font-size: 1rem;
      color: var(--main-fg);
      text-align: center;
      margin-bottom: 0.2em;
    }
    .theme-preview .theme-card .contrast-badge {
      font-size: 0.95rem;
      font-weight: bold;
      background: var(--accent4);
      color: var(--contrast-black);
      border-radius: 0.4em;
      padding: 0.2em 0.7em;
      margin-top: 0.4em;
      box-shadow: 0 1px 4px rgba(0,0,0,0.03);
      border: 2px solid var(--accent1);
    }
    .palette-list-section {
      margin-bottom: 2.5rem;
    }
    .palette-list-section h2 {
      margin-bottom: 0.7em;
    }
    .palette-list {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .palette-card {
      flex: 1 1 220px;
      max-width: 300px;
      min-width: 200px;
      background: #f7f7f7;
      border-radius: var(--border-radius);
      box-shadow: var(--palette-card-shadow);
      padding: 1.2rem 1rem;
      margin-bottom: 0.5em;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 0.7em;
      position: relative;
    }
    .palette-card .palette-title {
      font-weight: bold;
      color: var(--accent1);
      font-size: 1.1rem;
      margin-bottom: 0.4em;
      text-align: left;
    }
    .palette-card .palette-colors {
      display: flex;
      gap: 0.5em;
      margin-bottom: 0.7em;
      flex-wrap: wrap;
    }
    .palette-card .palette-color-swatch {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: 2px solid var(--accent1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      font-weight: bold;
      color: var(--contrast-black);
      background: repeating-linear-gradient(45deg, var(--main-bg) 0 8px, var(--accent4) 8px 16px);
      position: relative;
    }
    .palette-card .palette-color-swatch .swatch-label {
      position: absolute;
      left: 50%;
      top: 100%;
      transform: translate(-50%, 0.3em);
      background: var(--main-bg);
      color: var(--main-fg);
      font-size: 0.85rem;
      border-radius: 0.3em;
      padding: 0.1em 0.4em;
      box-shadow: 0 1px 2px rgba(0,0,0,0.03);
      white-space: nowrap;
      z-index: 2;
    }
    .palette-card .palette-meta {
      font-size: 0.98rem;
      color: var(--main-fg);
      margin-bottom: 0.3em;
    }
    .palette-card .palette-actions {
      margin-top: 0.4em;
      gap: 1em;
    }
    .palette-card .delete-palette-btn {
      background: var(--error);
      color: var(--contrast-white);
      border: none;
      border-radius: var(--border-radius);
      font-weight: bold;
      padding: 0.5em 1.2em;
      min-width: var(--min-touch);
      min-height: var(--min-touch);
      font-size: 1rem;
      cursor: pointer;
      transition: background var(--transition);
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    }
    .palette-card .delete-palette-btn:focus {
      background: var(--accent4);
      color: var(--contrast-black);
      outline: var(--focus-outline);
    }
    .palette-card .use-palette-btn {
      background: var(--accent3);
      color: var(--contrast-black);
      border: none;
      border-radius: var(--border-radius);
      font-weight: bold;
      padding: 0.5em 1.2em;
      min-width: var(--min-touch);
      min-height: var(--min-touch);
      font-size: 1rem;
      cursor: pointer;
      transition: background var(--transition);
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    }
    .palette-card .use-palette-btn:focus {
      background: var(--accent4);
      color: var(--contrast-black);
      outline: var(--focus-outline);
    }
    .palette-card .contrast-badge {
      font-size: 0.95rem;
      font-weight: bold;
      background: var(--accent4);
      color: var(--contrast-black);
      border-radius: 0.4em;
      padding: 0.2em 0.7em;
      margin-top: 0.4em;
      box-shadow: 0 1px 4px rgba(0,0,0,0.03);
      border: 2px solid var(--accent1);
    }
    .sitemap-section {
      background: var(--help-bg);
      color: var(--help-fg);
      border-radius: var(--border-radius);
      padding: 1.2rem 1rem;
      margin-bottom: 2.5rem;
      box-shadow: 0 1px 4px rgba(0,0,0,0.03);
    }
    .sitemap-section h2 {
      color: var(--accent1);
      margin-bottom: 0.5em;
    }
    .sitemap-list {
      list-style: disc inside;
      margin: 0;
      padding: 0 0 0 1.5em;
      font-size: 1rem;
    }
    .sitemap-list li {
      margin-bottom: 0.3em;
    }
    .sitemap-list a {
      color: var(--accent1);
      text-decoration: underline;
      font-weight: 600;
      background: none;
      border-radius: 0.2em;
      padding: 0.1em 0.4em;
      min-width: var(--min-touch);
      min-height: var(--min-touch);
    }
    .sitemap-list a:focus {
      background: var(--accent4);
      color: var(--contrast-black);
      outline: var(--focus-outline);
    }
    .contrast-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.5em;
      font-size: 1rem;
      font-weight: bold;
      margin-left: 0.5em;
      vertical-align: middle;
    }
    .contrast-indicator .icon {
      width: 1.2em;
      height: 1.2em;
      display: inline-block;
      vertical-align: middle;
    }
    .contrast-indicator.good {
      color: var(--success);
    }
    .contrast-indicator.bad {
      color: var(--error);
    }
    /* Responsive Design */
    @media (max-width: 600px) {
      header, nav, main, footer {
        max-width: 100vw;
        padding-left: 0;
        padding-right: 0;
      }
      .theme-preview .theme-visuals,
      .palette-list {
        flex-direction: column;
        gap: 1.2rem;
      }
      .color-mixer-form, .theme-preview, .palette-card, .theme-preview .theme-card {
        padding-left: 0.7rem;
        padding-right: 0.7rem;
      }
    }
    /* Enhanced focus indicators */
    :focus-visible {
      outline: var(--focus-outline) !important;
      outline-offset: 2px !important;
    }
    /* Prevent horizontal scroll at 200% zoom */
    html, body {
      overflow-x: hidden;
    }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-link" id="skip-link">Skip to main content</a>
  <header>
    <h1 id="site-title">Accessible Color Mixer & Custom Palette Creator</h1>
    <p>
      Mix colors, create accessible palettes, and preview high-contrast design themes in real time.<br>
      <span id="site-desc">All features fully comply with <abbr title="Web Content Accessibility Guidelines">WCAG</abbr> 2.2 <abbr title="Triple A">AAA</abbr> accessibility standards.</span>
    </p>
  </header>
  <nav aria-label="Main navigation" id="main-nav">
    <ul>
      <li>
        <a href="#main-content" aria-current="page">Palette Creator</a>
      </li>
      <li>
        <button type="button" aria-haspopup="true" aria-expanded="false" aria-controls="theme-menu" id="theme-menu-btn">
          Theme Previews
        </button>
        <ul class="submenu" id="theme-menu" aria-label="Theme Previews">
          <li><a href="#theme-preview-default">Default Theme</a></li>
          <li><a href="#theme-preview-dark">Dark Theme</a></li>
          <li><a href="#theme-preview-highcontrast">High Contrast</a></li>
        </ul>
      </li>
      <li>
        <a href="#palette-list-section">Saved Palettes</a>
      </li>
      <li>
        <a href="#sitemap-section">Sitemap</a>
      </li>
      <li>
        <a href="#help-section">Help</a>
      </li>
    </ul>
  </nav>
  <nav aria-label="Breadcrumb" class="breadcrumb-nav">
    <ol>
      <li><a href="#main-content">Home</a></li>
      <li aria-current="page">Palette Creator</li>
    </ol>
  </nav>
  <main id="main-content" tabindex="-1">
    <section aria-labelledby="color-mixer-heading">
      <h2 id="color-mixer-heading">Mix Colors and Build Your Palette</h2>
      <form id="color-mixer-form" class="color-mixer-form" autocomplete="off" aria-describedby="color-mixer-help" novalidate>
        <div class="help-text" id="color-mixer-help">
          <strong>Instructions:</strong> Add, mix, and name up to 6 colors for your custom palette. Each color must have a unique, descriptive name and a valid hex code.<br>
          <span id="color-mixer-required-note"><strong aria-label="Required">*</strong> Required fields. All colors must meet minimum contrast for accessibility.</span>
        </div>
        <fieldset aria-describedby="color-mixer-fieldset-help">
          <legend>Color Mixer Inputs</legend>
          <div id="color-mixer-fieldset-help" class="visually-hidden">
            Enter a name and select a color for each palette color. Remove or add colors as needed.
          </div>
          <div id="color-input-list">
            <!-- Color input rows will be dynamically generated here -->
          </div>
          <button type="button" class="add-color-btn" id="add-color-btn" aria-label="Add another color to palette">
            + Add Color
          </button>
        </fieldset>
        <div class="palette-actions">
          <button type="submit" class="save-palette-btn" id="save-palette-btn" aria-label="Save this palette">Save Palette</button>
          <button type="button" class="reset-palette-btn" id="reset-palette-btn" aria-label="Reset palette to default">Reset Palette</button>
          <button type="button" class="help-btn" id="open-help-btn" aria-label="Show context-sensitive help for palette creator">?</button>
        </div>
        <div id="form-status" role="status" aria-live="polite"></div>
      </form>
    </section>
    <section aria-labelledby="theme-preview-heading" id="theme-preview-section">
      <h2 id="theme-preview-heading">Real-Time Theme Previews</h2>
      <div class="help-text" id="theme-preview-help">
        <strong>Preview your palette:</strong> See how your colors look in different accessible theme layouts. Each theme shows a sample UI with contrast checks.
      </div>
      <div class="theme-preview" id="theme-preview">
        <!-- Theme previews will be dynamically generated here -->
      </div>
    </section>
    <section aria-labelledby="palette-list-heading" class="palette-list-section" id="palette-list-section">
      <h2 id="palette-list-heading">Saved Palettes</h2>
      <div class="help-text" id="palette-list-help">
        <strong>Manage your palettes:</strong> Browse, use, or delete your saved palettes. Each palette displays its colors and accessibility info.
      </div>
      <div class="palette-list" id="palette-list">
        <!-- Saved palettes will be rendered here -->
      </div>
    </section>
    <section aria-labelledby="sitemap-heading" class="sitemap-section" id="sitemap-section">
      <h2 id="sitemap-heading">Sitemap</h2>
      <ul class="sitemap-list">
        <li><a href="#main-content">Palette Creator</a></li>
        <li><a href="#theme-preview-section">Theme Previews</a></li>
        <li><a href="#palette-list-section">Saved Palettes</a></li>
        <li><a href="#help-section">Help & Accessibility Info</a></li>
      </ul>
    </section>
    <section aria-labelledby="help-heading" id="help-section">
      <h2 id="help-heading">Help & Accessibility Information</h2>
      <div class="help-text" id="help-main">
        <strong>How to use this page:</strong>
        <ul>
          <li><strong>Mix Colors:</strong> Add up to 6 colors with unique names. Use the color picker or enter a hex code. Remove colors as needed.</li>
          <li><strong>Preview Themes:</strong> See your palette in real-time across accessible theme layouts. Contrast is checked automatically.</li>
          <li><strong>Save & Manage Palettes:</strong> Save palettes to your browser, use them later, or delete them.</li>
          <li><strong>Keyboard Navigation:</strong> All controls are keyboard accessible. Use Tab/Shift+Tab to move, Enter/Space to activate.</li>
          <li><strong>Contrast & Accessibility:</strong> All color combinations are checked for WCAG 2.2 AAA compliance (7:1 for text). Warnings appear for insufficient contrast.</li>
        </ul>
        <strong>Accessibility Features:</strong>
        <ul>
          <li>All controls have visible, high-contrast focus indicators (minimum 3:1 contrast, 2px thick).</li>
          <li>Skip links, headings, ARIA labels, and live status regions for screen readers.</li>
          <li>Minimum 44x44px touch targets for all interactive elements.</li>
          <li>All forms have explicit labels, error handling, and context-sensitive help.</li>
          <li>Supports zoom to 200% without horizontal scroll. Colorful, vibrant design meets AAA contrast.</li>
          <li>Motion/animation respects <code>prefers-reduced-motion</code> and can be disabled.</li>
        </ul>
        <strong>Unusual Words & Abbreviations:</strong>
        <dl>
          <dt><abbr title="Web Content Accessibility Guidelines">WCAG</abbr></dt>
          <dd>International guidelines for making web content accessible to people with disabilities.</dd>
          <dt><abbr title="Triple A">AAA</abbr></dt>
          <dd>The highest level of accessibility conformance in WCAG.</dd>
          <dt>Palette</dt>
          <dd>A set of colors used together in a design.</dd>
        </dl>
        <strong>Reading Level:</strong> All content is written at a lower secondary education reading level. <a href="#help-simplified" id="show-simplified-help">Show simplified help</a>.
        <span id="help-pronunciation" class="visually-hidden">
          Pronunciation: "palette" is pronounced /pæˈlɛt/ (pa-LET).
        </span>
      </div>
      <div class="help-text visually-hidden" id="help-simplified">
        <strong>Simplified Help:</strong>
        <ul>
          <li>Add colors with names to your palette.</li>
          <li>See how your colors look in sample designs.</li>
          <li>Save your palette or use a saved one.</li>
          <li>Everything is easy to use with keyboard and screen readers.</li>
        </ul>
        <a href="#help-main" id="hide-simplified-help">Hide simplified help</a>
      </div>
      <div class="help-text" id="motion-controls-help">
        <strong>Motion & Animation:</strong>
        <ul>
          <li>Animations are minimal and respect your system settings.</li>
          <li>If you want to disable all motion, use the button below.</li>
        </ul>
        <button type="button" id="disable-motion-btn" aria-pressed="false" aria-label="Disable all animations and motion">Disable Motion</button>
        <span id="motion-status" role="status" aria-live="polite"></span>
      </div>
      <div class="help-text" id="auth-help">
        <strong>Authentication & Privacy:</strong>
        <ul>
          <li>No login or personal data is required or stored.</li>
          <li>All palettes are saved only in your browser and can be deleted at any time.</li>
        </ul>
      </div>
      <div class="help-text" id="contact-help">
        <strong>Contact & Feedback:</strong>
        <ul>
          <li>For feedback or accessibility issues, please <a href="mailto:accessibility@example.com" aria-label="Email accessibility support">email accessibility support</a>.</li>
        </ul>
      </div>
    </section>
  </main>
  <footer>
    <hr>
    <p>
      <strong>Accessible Color Mixer & Custom Palette Creator</strong> &copy; 2024. All rights reserved.<br>
      Designed for <abbr title="Web Content Accessibility Guidelines">WCAG</abbr> 2.2 <abbr title="Triple A">AAA</abbr> compliance.<br>
      <a href="#help-section">Accessibility &amp; Help</a>
    </p>
  </footer>
  <script>
    // Accessibility utility functions
    function setFocusVisiblePolyfill() {
      // Simple polyfill for :focus-visible if not supported
      try {
        document.querySelector(':focus-visible');
      } catch (e) {
        document.body.addEventListener('focusin', function(e) {
          if (e.target.matches('a, button, input, select, textarea')) {
            e.target.style.outline = '3px solid #FFD600';
            e.target.style.outlineOffset = '2px';
          }
        });
        document.body.addEventListener('focusout', function(e) {
          if (e.target.matches('a, button, input, select, textarea')) {
            e.target.style.outline = '';
            e.target.style.outlineOffset = '';
          }
        });
      }
    }
    setFocusVisiblePolyfill();

    // Color contrast checking (WCAG 2.2 AAA: 7:1 for normal text)
    function luminance(rgb) {
      // rgb: [r, g, b] in 0..255
      let a = rgb.map(function(v) {
        v = v / 255;
        return v <= 0.03928
          ? v / 12.92
          : Math.pow((v + 0.055) / 1.055, 2.4);
      });
      return 0.2126 * a[0] + 0.7152 * a[1] + 0.0722 * a[2];
    }
    function hexToRgb(hex) {
      hex = hex.replace(/^#/, '');
      if (hex.length === 3) {
        hex = hex.split('').map(function(x) { return x + x; }).join('');
      }
      let num = parseInt(hex, 16);
      return [
        (num >> 16) & 255,
        (num >> 8) & 255,
        num & 255
      ];
    }
    function contrastRatio(hex1, hex2) {
      let rgb1 = hexToRgb(hex1);
      let rgb2 = hexToRgb(hex2);
      let lum1 = luminance(rgb1) + 0.05;
      let lum2 = luminance(rgb2) + 0.05;
      let ratio = lum1 > lum2 ? lum1 / lum2 : lum2 / lum1;
      return ratio;
    }
    function isValidHex(hex) {
      return /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(hex);
    }
    function getTextColor(bgHex) {
      // Returns #000 or #fff depending on contrast with bgHex
      if (!isValidHex(bgHex)) return '#000';
      let contrastWithBlack = contrastRatio(bgHex, '#000');
      let contrastWithWhite = contrastRatio(bgHex, '#fff');
      // Return color with highest contrast
      return contrastWithBlack > contrastWithWhite ? '#000' : '#fff';
    }
    function getContrastBadge(ratio, required = 7) {
      let good = ratio >= required;
      let icon = good
        ? '<svg class="icon" aria-hidden="true" focusable="false" viewBox="0 0 20 20"><circle cx="10" cy="10" r="9" fill="#007E33"/><path d="M6 10l3 3 5-5" stroke="#fff" stroke-width="2" fill="none"/></svg>'
        : '<svg class="icon" aria-hidden="true" focusable="false" viewBox="0 0 20 20"><circle cx="10" cy="10" r="9" fill="#B00020"/><path d="M6 6l8 8M14 6l-8 8" stroke="#fff" stroke-width="2" fill="none"/></svg>';
      return `<span class="contrast-indicator ${good ? 'good' : 'bad'}" aria-label="Contrast ratio: ${ratio.toFixed(2)}${good ? ', AAA compliant' : ', not AAA compliant'}">${icon} ${ratio.toFixed(2)}${good ? '' : ' (needs ≥ 7.00)'}</span>`;
    }

    // Palette state
    let paletteColors = [
      { name: 'Primary', color: '#005A9E' },
      { name: 'Accent', color: '#F25F5C' },
      { name: 'Background', color: '#FFFFFF' }
    ];
    const MAX_COLORS = 6;
    const MIN_COLORS = 2;
    let savedPalettes = [];
    let motionDisabled = false;

    // Accessibility: Live region for form status
    const formStatus = document.getElementById('form-status');
    function showFormStatus(message, type = 'info') {
      formStatus.innerHTML = '';
      if (!message) return;
      let el = document.createElement('div');
      el.className = type === 'error' ? 'error-message' : type === 'success' ? 'success-message' : '';
      el.textContent = message;
      formStatus.appendChild(el);
    }

    // Accessibility: Context-sensitive help
    const helpSection = document.getElementById('help-section');
    const openHelpBtn = document.getElementById('open-help-btn');
    openHelpBtn.addEventListener('click', function() {
      helpSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      setTimeout(() => {
        helpSection.focus();
      }, 400);
    });

    // Palette color input rendering
    function renderColorInputs() {
      const colorInputList = document.getElementById('color-input-list');
      colorInputList.innerHTML = '';
      paletteColors.forEach((colorObj, idx) => {
        const row = document.createElement('div');
        row.className = 'color-input-row';
        row.setAttribute('role', 'group');
        row.setAttribute('aria-labelledby', `color-name-label-${idx} color-hex-label-${idx}`);
        // Color name input
        const nameGroup = document.createElement('div');
        nameGroup.className = 'color-input-group';
        const nameLabel = document.createElement('label');
        nameLabel.setAttribute('for', `color-name-${idx}`);
        nameLabel.id = `color-name-label-${idx}`;
        nameLabel.innerHTML = `Color Name <span aria-label="Required">*</span>`;
        nameGroup.appendChild(nameLabel);
        const nameInput = document.createElement('input');
        nameInput.type = 'text';
        nameInput.id = `color-name-${idx}`;
        nameInput.name = `color-name-${idx}`;
        nameInput.value = colorObj.name;
        nameInput.setAttribute('required', 'required');
        nameInput.setAttribute('aria-required', 'true');
        nameInput.setAttribute('maxlength', '18');
        nameInput.setAttribute('aria-describedby', `color-name-help-${idx}`);
        nameInput.setAttribute('autocomplete', 'off');
        nameInput.style.letterSpacing = '0.01em';
        nameInput.addEventListener('input', function() {
          paletteColors[idx].name = nameInput.value;
        });
        nameGroup.appendChild(nameInput);
        const nameHelp = document.createElement('div');
        nameHelp.className = 'visually-hidden';
        nameHelp.id = `color-name-help-${idx}`;
        nameHelp.textContent = 'Enter a unique, descriptive name for this color.';
        nameGroup.appendChild(nameHelp);

        // Color hex input and picker
        const colorGroup = document.createElement('div');
        colorGroup.className = 'color-input-group';
        const colorLabel = document.createElement('label');
        colorLabel.setAttribute('for', `color-hex-${idx}`);
        colorLabel.id = `color-hex-label-${idx}`;
        colorLabel.innerHTML = `Color Hex <span aria-label="Required">*</span>`;
        colorGroup.appendChild(colorLabel);
        const colorPicker = document.createElement('input');
        colorPicker.type = 'color';
        colorPicker.id = `color-picker-${idx}`;
        colorPicker.name = `color-picker-${idx}`;
        colorPicker.value = colorObj.color;
        colorPicker.setAttribute('aria-label', `Pick color for ${colorObj.name || 'Color ' + (idx + 1)}`);
        colorPicker.setAttribute('tabindex', '0');
        colorPicker.addEventListener('input', function() {
          colorInput.value = colorPicker.value;
          paletteColors[idx].color = colorPicker.value;
          renderColorInputs();
          renderThemePreview();
        });
        colorGroup.appendChild(colorPicker);
        const colorInput = document.createElement('input');
        colorInput.type = 'text';
        colorInput.id = `color-hex-${idx}`;
        colorInput.name = `color-hex-${idx}`;
        colorInput.value = colorObj.color;
        colorInput.setAttribute('pattern', '^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$');
        colorInput.setAttribute('required', 'required');
        colorInput.setAttribute('aria-required', 'true');
        colorInput.setAttribute('maxlength', '7');
        colorInput.setAttribute('aria-describedby', `color-hex-help-${idx}`);
        colorInput.setAttribute('autocomplete', 'off');
        colorInput.addEventListener('input', function() {
          paletteColors[idx].color = colorInput.value;
          colorPicker.value = isValidHex(colorInput.value) ? colorInput.value : colorPicker.value;
          renderColorInputs();
          renderThemePreview();
        });
        colorGroup.appendChild(colorInput);
        const colorHelp = document.createElement('div');
        colorHelp.className = 'visually-hidden';
        colorHelp.id = `color-hex-help-${idx}`;
        colorHelp.textContent = 'Enter a valid hex color code, e.g. #005A9E.';
        colorGroup.appendChild(colorHelp);
        // Color sample
        const colorSample = document.createElement('span');
        colorSample.className = 'color-sample';
        colorSample.setAttribute('title', `Sample for ${colorObj.name || 'Color ' + (idx + 1)}`);
        colorSample.setAttribute('aria-label', `Sample for ${colorObj.name || 'Color ' + (idx + 1)}`);
        colorSample.style.background = isValidHex(colorObj.color) ? colorObj.color : '#fff';
        colorGroup.appendChild(colorSample);

        row.appendChild(nameGroup);
        row.appendChild(colorGroup);

        // Remove button
        if (paletteColors.length > MIN_COLORS) {
          const removeBtn = document.createElement('button');
          removeBtn.type = 'button';
          removeBtn.className = 'remove-color-btn';
          removeBtn.textContent = 'Remove';
          removeBtn.setAttribute('aria-label', `Remove color ${colorObj.name || (idx + 1)}`);
          removeBtn.setAttribute('tabindex', '0');
          removeBtn.addEventListener('click', function() {
            paletteColors.splice(idx, 1);
            renderColorInputs();
            renderThemePreview();
          });
          row.appendChild(removeBtn);
        }
        colorInputList.appendChild(row);
      });
      // Disable add button if at max
      document.getElementById('add-color-btn').disabled = paletteColors.length >= MAX_COLORS;
    }
    document.getElementById('add-color-btn').addEventListener('click', function() {
      if (paletteColors.length < MAX_COLORS) {
        paletteColors.push({ name: '', color: '#FFFFFF' });
        renderColorInputs();
        renderThemePreview();
      }
    });
    document.getElementById('reset-palette-btn').addEventListener('click', function() {
      paletteColors = [
        { name: 'Primary', color: '#005A9E' },
        { name: 'Accent', color: '#F25F5C' },
        { name: 'Background', color: '#FFFFFF' }
      ];
      renderColorInputs();
      renderThemePreview();
      showFormStatus('Palette reset to default.', 'success');
    });

    // Palette validation
    function validatePalette(colors) {
      let errors = [];
      if (!Array.isArray(colors) || colors.length < MIN_COLORS) {
        errors.push('At least two colors are required.');
      }
      let names = new Set();
      colors.forEach((c, i) => {
        if (!c.name || !c.name.trim()) {
          errors.push(`Color ${i + 1} name is required.`);
        }
        if (names.has(c.name.trim().toLowerCase())) {
          errors.push(`Color names must be unique. "${c.name}" is duplicated.`);
        }
        names.add(c.name.trim().toLowerCase());
        if (!isValidHex(c.color)) {
          errors.push(`Color ${i + 1} hex code is invalid.`);
        }
      });
      return errors;
    }

    // Palette save
    function savePalette(e) {
      e.preventDefault();
      showFormStatus('');
      let errors = validatePalette(paletteColors);
      if (errors.length > 0) {
        showFormStatus(errors.join(' '), 'error');
        return;
      }
      // Check contrast for all color pairs
      let contrastWarnings = [];
      for (let i = 0; i < paletteColors.length; ++i) {
        for (let j = i + 1; j < paletteColors.length; ++j) {
          let ratio = contrastRatio(paletteColors[i].color, paletteColors[j].color);
          if (ratio < 7) {
            contrastWarnings.push(`Contrast between "${paletteColors[i].name}" and "${paletteColors[j].name}" is ${ratio.toFixed(2)} (needs ≥ 7.00).`);
          }
        }
      }
      if (contrastWarnings.length > 0) {
        showFormStatus('Palette has insufficient contrast: ' + contrastWarnings.join(' '), 'error');
        return;
      }
      // Save to localStorage
      let newPalette = {
        id: 'palette-' + Date.now(),
        colors: JSON.parse(JSON.stringify(paletteColors)),
        created: new Date().toISOString()
      };
      savedPalettes.unshift(newPalette);
      // Keep only last 12
      savedPalettes = savedPalettes.slice(0, 12);
      localStorage.setItem('accessible-palettes', JSON.stringify(savedPalettes));
      renderPaletteList();
      showFormStatus('Palette saved successfully!', 'success');
    }
    document.getElementById('color-mixer-form').addEventListener('submit', savePalette);

    // Load palettes from localStorage
    function loadPalettes() {
      let data = localStorage.getItem('accessible-palettes');
      if (data) {
        try {
          savedPalettes = JSON.parse(data);
        } catch (e) {
          savedPalettes = [];
        }
      }
    }
    function renderPaletteList() {
      const list = document.getElementById('palette-list');
      list.innerHTML = '';
      if (!savedPalettes.length) {
        let empty = document.createElement('div');
        empty.textContent = 'No palettes saved yet. Save a palette to see it here.';
        empty.style.fontStyle = 'italic';
        list.appendChild(empty);
        return;
      }
      savedPalettes.forEach((palette, idx) => {
        const card = document.createElement('div');
        card.className = 'palette-card';
        // Title
        const title = document.createElement('div');
        title.className = 'palette-title';
        title.textContent = `Palette ${idx + 1}`;
        card.appendChild(title);
        // Colors
        const colorsDiv = document.createElement('div');
        colorsDiv.className = 'palette-colors';
        palette.colors.forEach((c, i) => {
          const swatch = document.createElement('span');
          swatch.className = 'palette-color-swatch';
          swatch.style.background = isValidHex(c.color) ? c.color : '#fff';
          swatch.style.color = getTextColor(c.color);
          swatch.setAttribute('title', `${c.name}: ${c.color}`);
          swatch.setAttribute('aria-label', `${c.name}: ${c.color}`);
          // Swatch label for colorblind accessibility
          const swatchLabel = document.createElement('span');
          swatchLabel.className = 'swatch-label';
          swatchLabel.textContent = c.name;
          swatch.appendChild(swatchLabel);
          colorsDiv.appendChild(swatch);
        });
        card.appendChild(colorsDiv);
        // Meta info
        const meta = document.createElement('div');
        meta.className = 'palette-meta';
        let date = new Date(palette.created);
        meta.textContent = `Saved: ${date.toLocaleString()}`;
        card.appendChild(meta);
        // Contrast badge
        let minContrast = 99;
        for (let i = 0; i < palette.colors.length; ++i) {
          for (let j = i + 1; j < palette.colors.length; ++j) {
            let ratio = contrastRatio(palette.colors[i].color, palette.colors[j].color);
            minContrast = Math.min(minContrast, ratio);
          }
        }
        const badge = document.createElement('div');
        badge.className = 'contrast-badge';
        badge.innerHTML = getContrastBadge(minContrast, 7);
        card.appendChild(badge);
        // Actions
        const actions = document.createElement('div');
        actions.className = 'palette-actions';
        // Use palette
        const useBtn = document.createElement('button');
        useBtn.className = 'use-palette-btn';
        useBtn.textContent = 'Use Palette';
        useBtn.setAttribute('aria-label', `Use this palette`);
        useBtn.addEventListener('click', function() {
          paletteColors = JSON.parse(JSON.stringify(palette.colors));
          renderColorInputs();
          renderThemePreview();
          showFormStatus('Palette loaded into editor.', 'success');
        });
        actions.appendChild(useBtn);
        // Delete palette
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-palette-btn';
        deleteBtn.textContent = 'Delete';
        deleteBtn.setAttribute('aria-label', `Delete this palette`);
        deleteBtn.addEventListener('click', function() {
          if (confirm('Are you sure you want to delete this palette?')) {
            savedPalettes.splice(idx, 1);
            localStorage.setItem('accessible-palettes', JSON.stringify(savedPalettes));
            renderPaletteList();
            showFormStatus('Palette deleted.', 'success');
          }
        });
        actions.appendChild(deleteBtn);
        card.appendChild(actions);
        list.appendChild(card);
      });
    }

    // Theme preview rendering
    function renderThemePreview() {
      const preview = document.getElementById('theme-preview');
      preview.innerHTML = '';
      // Theme definitions
      const themes = [
        {
          id: 'theme-preview-default',
          name: 'Default Theme',
          desc: 'A clean, light UI using your palette as primary and accent colors.',
          layout: function(colors) {
            // Map colors: 0=primary, 1=accent, 2=background, 3+=extra
            let bg = colors[2] ? colors[2].color : '#fff';
            let fg = getTextColor(bg);
            let accent = colors[1] ? colors[1].color : '#005A9E';
            let primary = colors[0] ? colors[0].color : '#005A9E';
            let extra = colors[3] ? colors[3].color : accent;
            return {
              bg, fg, accent, primary, extra
            };
          }
        },
        {
          id: 'theme-preview-dark',
          name: 'Dark Theme',
          desc: 'A dark background UI using your palette for highlights.',
          layout: function(colors) {
            let bg = colors[3] ? colors[3].color : '#222';
            let fg = getTextColor(bg);
            let accent = colors[1] ? colors[1].color : '#F25F5C';
            let primary = colors[0] ? colors[0].color : '#005A9E';
            let extra = colors[2] ? colors[2].color : '#fff';
            return {
              bg, fg, accent, primary, extra
            };
          }
        },
        {
          id: 'theme-preview-highcontrast',
          name: 'High Contrast',
          desc: 'A bold, high-contrast UI layout to test AAA compliance.',
          layout: function(colors) {
            let bg = '#000';
            let fg = '#fff';
            let accent = colors[1] ? colors[1].color : '#FFD600';
            let primary = colors[0] ? colors[0].color : '#70C1B3';
            let extra = colors[2] ? colors[2].color : '#fff';
            return {
              bg, fg, accent, primary, extra
            };
          }
        }
      ];
      // For each theme
      themes.forEach(theme => {
        const card = document.createElement('div');
        card.className = 'theme-card';
        card.id = theme.id;
        // Title
        const title = document.createElement('div');
        title.className = 'theme-title';
        title.textContent = theme.name;
        card.appendChild(title);
        // Sample UI
        const sample = document.createElement('div');
        sample.className = 'theme-sample';
        let layout = theme.layout(paletteColors);
        sample.style.background = layout.bg;
        sample.style.color = layout.fg;
        sample.style.borderColor = layout.accent;
        sample.innerHTML = `
          <span style="font-size:1.15em;font-weight:bold;">Sample UI</span>
          <span style="margin-left:1em;padding:0.2em 0.5em;border-radius:0.4em;background:${layout.accent};color:${getTextColor(layout.accent)};font-size:1em;">Accent</span>
        `;
        card.appendChild(sample);
        // Description
        const desc = document.createElement('div');
        desc.className = 'theme-desc';
        desc.textContent = theme.desc;
        card.appendChild(desc);
        // Contrast badge
        // Check contrast of text vs bg, accent vs bg, accent vs text
        let ratios = [
          contrastRatio(layout.fg, layout.bg),
          contrastRatio(layout.accent, layout.bg),
          contrastRatio(layout.accent, layout.fg)
        ];
        let minRatio = Math.min(...ratios);
        const badge = document.createElement('div');
        badge.className = 'contrast-badge';
        badge.innerHTML = getContrastBadge(minRatio, 7);
        card.appendChild(badge);
        preview.appendChild(card);
      });
    }

    // Menu keyboard navigation (AAA compliant)
    const themeMenuBtn = document.getElementById('theme-menu-btn');
    const themeMenu = document.getElementById('theme-menu');
    themeMenuBtn.addEventListener('click', function(e) {
      let expanded = themeMenuBtn.getAttribute('aria-expanded') === 'true';
      themeMenuBtn.setAttribute('aria-expanded', !expanded);
      if (!expanded) {
        themeMenu.style.display = 'block';
        themeMenu.querySelector('a').focus();
      } else {
        themeMenu.style.display = 'none';
      }
    });
    themeMenuBtn.addEventListener('keydown', function(e) {
      if (e.key === 'ArrowDown' || e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        themeMenuBtn.setAttribute('aria-expanded', 'true');
        themeMenu.style.display = 'block';
        themeMenu.querySelector('a').focus();
      }
    });
    themeMenu.addEventListener('keydown', function(e) {
      let items = Array.from(themeMenu.querySelectorAll('a'));
      let idx = items.indexOf(document.activeElement);
      if (e.key === 'ArrowDown') {
        e.preventDefault();
        items[(idx + 1) % items.length].focus();
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        items[(idx - 1 + items.length) % items.length].focus();
      } else if (e.key === 'Escape') {
        e.preventDefault();
        themeMenuBtn.setAttribute('aria-expanded', 'false');
        themeMenu.style.display = 'none';
        themeMenuBtn.focus();
      }
    });
    // Close menu on outside click
    document.addEventListener('mousedown', function(e) {
      if (!themeMenu.contains(e.target) && e.target !== themeMenuBtn) {
        themeMenuBtn.setAttribute('aria-expanded', 'false');
        themeMenu.style.display = 'none';
      }
    });

    // Skip link: move focus to main
    document.getElementById('skip-link').addEventListener('click', function(e) {
      setTimeout(function() {
        document.getElementById('main-content').focus();
      }, 100);
    });

    // Motion/animation controls
    const disableMotionBtn = document.getElementById('disable-motion-btn');
    const motionStatus = document.getElementById('motion-status');
    disableMotionBtn.addEventListener('click', function() {
      motionDisabled = !motionDisabled;
      if (motionDisabled) {
        document.body.classList.add('motion-off');
        disableMotionBtn.setAttribute('aria-pressed', 'true');
        motionStatus.textContent = 'All motion and animation is now disabled.';
        let style = document.createElement('style');
        style.id = 'motion-off-style';
        style.innerHTML = `
          * { transition: none !important; animation: none !important; }
        `;
        document.head.appendChild(style);
      } else {
        document.body.classList.remove('motion-off');
        disableMotionBtn.setAttribute('aria-pressed', 'false');
        motionStatus.textContent = 'Motion and animation enabled (respects your system settings).';
        let style = document.getElementById('motion-off-style');
        if (style) style.remove();
      }
    });

    // Simplified help toggle
    document.getElementById('show-simplified-help').addEventListener('click', function(e) {
      e.preventDefault();
      document.getElementById('help-main').classList.add('visually-hidden');
      document.getElementById('help-simplified').classList.remove('visually-hidden');
      document.getElementById('help-simplified').focus();
    });
    document.getElementById('hide-simplified-help').addEventListener('click', function(e) {
      e.preventDefault();
      document.getElementById('help-main').classList.remove('visually-hidden');
      document.getElementById('help-simplified').classList.add('visually-hidden');
      document.getElementById('help-main').focus();
    });

    // Initial render
    loadPalettes();
    renderColorInputs();
    renderThemePreview();
    renderPaletteList();

    // Accessibility: Focus management for status messages
    formStatus.addEventListener('DOMSubtreeModified', function() {
      if (formStatus.textContent.trim()) {
        formStatus.setAttribute('tabindex', '-1');
        formStatus.focus();
      }
    });

    // Responsive: Adjust for zoom
    window.addEventListener('resize', function() {
      document.body.style.maxWidth = window.innerWidth < 700 ? '100vw' : '80ch';
    });

    // Touch support: Ensure 44x44px minimum for all buttons/inputs
    function ensureTouchTargets() {
      let targets = document.querySelectorAll('button, input[type="color"], input[type="text"], a');
      targets.forEach(function(el) {
        el.style.minWidth = '44px';
        el.style.minHeight = '44px';
      });
    }
    ensureTouchTargets();

    // Error prevention: Confirm before navigation if unsaved changes
    let formDirty = false;
    document.getElementById('color-mixer-form').addEventListener('input', function() {
      formDirty = true;
    });
    window.addEventListener('beforeunload', function(e) {
      if (formDirty) {
        e.preventDefault();
        e.returnValue = 'You have unsaved changes to your palette. Are you sure you want to leave?';
      }
    });

    // Error prevention for palette deletion
    document.getElementById('palette-list').addEventListener('click', function(e) {
      if (e.target.classList.contains('delete-palette-btn')) {
        formDirty = false;
      }
    });

    // ARIA live region for theme preview updates
    const themePreview = document.getElementById('theme-preview');
    themePreview.setAttribute('aria-live', 'polite');
    themePreview.setAttribute('role', 'region');
    themePreview.setAttribute('aria-label', 'Theme preview area');

    // Focus trap for modal (if implemented in future)
    // (Not used here, but structure ready for AAA compliance)
  </script>
</body>
</html>