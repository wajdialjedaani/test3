<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Accessible Fitness Tracker – Log Workouts & Track Progress</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- User-selectable color scheme -->
  <meta name="color-scheme" content="light dark">
  <style>
    :root {
      /* High-contrast, vibrant color palette meeting 7:1+ ratios */
      --primary-bg: #1b1b32;
      --primary-bg-light: #26264a;
      --secondary-bg: #e6f4ff;
      --accent1: #0d99ff;
      --accent2: #ff9c07;
      --accent3: #00b38f;
      --accent4: #c70d5a;
      --text: #fff;
      --text-dark: #181818;
      --error: #c70d5a;
      --success: #00b38f;
      --focus: #f9ed32;
      --focus-outline: 2px solid #f9ed32;
      --border: #0d99ff;
      --shadow: 0 2px 8px rgba(13, 153, 255, 0.15);
      --button-bg: #0d99ff;
      --button-text: #fff;
      --button-hover: #0876c9;
      --input-bg: #fff;
      --input-text: #181818;
      --input-border: #0d99ff;
      --input-focus: #ff9c07;
      --card-bg: #26264a;
      --card-border: #0d99ff;
      --progress-bg: #e6f4ff;
      --progress-bar: #0d99ff;
      --progress-bar2: #00b38f;
      --progress-bar3: #ff9c07;
      --nav-bg: #1b1b32;
      --nav-link: #fff;
      --nav-link-active: #f9ed32;
      --nav-link-focus: #ff9c07;
      --skip-link-bg: #f9ed32;
      --skip-link-text: #181818;
      --help-bg: #e6f4ff;
      --help-text: #181818;
      --sitemap-bg: #26264a;
      --sitemap-link: #f9ed32;
      --sitemap-link-hover: #ff9c07;
      --focus-shadow: 0 0 0 4px #f9ed32;
      /* User custom colors (overridable) */
      --user-fg: var(--text);
      --user-bg: var(--primary-bg);
    }
    html, body {
      background: var(--user-bg);
      color: var(--user-fg);
      font-family: 'Segoe UI', Arial, sans-serif;
      font-size: 1.125rem;
      line-height: 1.6;
      margin: 0;
      padding: 0;
      min-height: 100%;
      scroll-behavior: smooth;
    }
    body {
      background: linear-gradient(135deg, var(--primary-bg) 0%, var(--accent1) 100%);
      min-height: 100vh;
      transition: background 0.3s;
    }
    header, nav, main, footer, section, aside {
      display: block;
    }
    /* Skip link */
    .skip-link {
      position: absolute;
      left: 0;
      top: 0;
      background: var(--skip-link-bg);
      color: var(--skip-link-text);
      padding: 0.5em 1em;
      z-index: 1000;
      font-weight: bold;
      border-radius: 0 0 8px 0;
      transform: translateY(-100%);
      transition: transform 0.2s;
      text-decoration: none;
      outline: none;
    }
    .skip-link:focus {
      transform: translateY(0);
      outline: var(--focus-outline);
      box-shadow: var(--focus-shadow);
    }
    /* Header */
    header {
      background: var(--primary-bg-light);
      padding: 1.5em 1em 1em 1em;
      box-shadow: var(--shadow);
      border-bottom: 4px solid var(--accent1);
      position: relative;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 1em;
    }
    .brand-logo {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--accent1) 60%, var(--accent3) 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2em;
      font-weight: bold;
      color: var(--primary-bg);
      border: 2px solid var(--accent2);
      box-shadow: var(--shadow);
    }
    .brand-title {
      font-size: 2em;
      font-weight: 700;
      color: var(--text);
      margin: 0;
      letter-spacing: 0.02em;
      text-shadow: 1px 1px 0 var(--accent2);
    }
    /* Navigation */
    nav[aria-label] {
      background: var(--nav-bg);
      margin-top: 1em;
      margin-bottom: 0.5em;
      border-radius: 8px;
      box-shadow: var(--shadow);
      padding: 0.5em 0;
      display: flex;
      justify-content: center;
    }
    .nav-list {
      display: flex;
      gap: 2em;
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .nav-list li {
      position: relative;
    }
    .nav-link {
      color: var(--nav-link);
      background: none;
      border: none;
      font-size: 1.125em;
      padding: 0.75em 1.5em;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      min-width: 44px;
      min-height: 44px;
      text-decoration: none;
      outline: none;
      font-weight: 600;
      display: inline-block;
    }
    .nav-link:focus {
      outline: var(--focus-outline);
      background: var(--nav-link-focus);
      color: var(--primary-bg);
      box-shadow: var(--focus-shadow);
    }
    .nav-link[aria-current="page"], .nav-link.active {
      background: var(--accent1);
      color: var(--nav-link-active);
      cursor: default;
    }
    /* Breadcrumbs */
    nav[aria-label="Breadcrumb"] {
      background: none;
      margin: 0.5em 0 1.5em 0;
      padding: 0;
      font-size: 1em;
    }
    .breadcrumb-list {
      display: flex;
      gap: 0.5em;
      list-style: none;
      margin: 0;
      padding: 0;
      flex-wrap: wrap;
      align-items: center;
    }
    .breadcrumb-list li {
      display: flex;
      align-items: center;
    }
    .breadcrumb-list li:not(:last-child)::after {
      content: "›";
      margin: 0 0.5em;
      color: var(--accent2);
      font-weight: bold;
      font-size: 1.1em;
    }
    .breadcrumb-link {
      color: var(--sitemap-link);
      text-decoration: underline;
      background: none;
      border: none;
      font-size: 1em;
      cursor: pointer;
      min-width: 44px;
      min-height: 44px;
      padding: 0.25em 0.5em;
      border-radius: 4px;
      transition: background 0.2s;
      outline: none;
    }
    .breadcrumb-link:focus {
      outline: var(--focus-outline);
      background: var(--accent2);
      color: var(--primary-bg);
      box-shadow: var(--focus-shadow);
    }
    .breadcrumb-current {
      color: var(--accent2);
      font-weight: bold;
      text-decoration: none;
      cursor: default;
    }
    /* Main Layout */
    main {
      display: flex;
      flex-wrap: wrap;
      gap: 2em;
      padding: 2em 1em 2em 1em;
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(38,38,74,0.97);
      border-radius: 18px;
      box-shadow: var(--shadow);
      min-height: 65vh;
    }
    .main-content {
      flex: 3 1 500px;
      min-width: 320px;
      max-width: 700px;
    }
    aside.sidebar {
      flex: 1 1 260px;
      min-width: 260px;
      max-width: 340px;
      background: var(--card-bg);
      color: var(--text);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 1.5em 1em;
      margin-top: 0.5em;
      margin-bottom: 0.5em;
      font-size: 1em;
    }
    /* Section Headings */
    h1, h2, h3, h4 {
      font-family: 'Segoe UI', Arial, sans-serif;
      font-weight: 700;
      margin-top: 0;
      margin-bottom: 0.7em;
      letter-spacing: 0.01em;
    }
    h1 {
      font-size: 2.2em;
      color: var(--accent1);
      text-shadow: 1px 1px 0 var(--primary-bg-light);
      margin-bottom: 0.5em;
    }
    h2 {
      font-size: 1.5em;
      color: var(--accent2);
      margin-bottom: 0.5em;
    }
    h3 {
      font-size: 1.2em;
      color: var(--accent3);
      margin-bottom: 0.4em;
    }
    h4 {
      font-size: 1em;
      color: var(--accent4);
      margin-bottom: 0.3em;
    }
    /* Workout Log Table */
    .workout-log-section {
      margin-bottom: 2em;
    }
    .workout-table-container {
      overflow-x: auto;
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 1em;
      margin-bottom: 1.5em;
    }
    table.workout-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: none;
      color: var(--text);
      font-size: 1em;
      margin: 0;
    }
    table.workout-table th, table.workout-table td {
      padding: 0.7em 1em;
      text-align: left;
      border-bottom: 2px solid var(--accent1);
      vertical-align: middle;
    }
    table.workout-table th {
      background: var(--accent1);
      color: var(--primary-bg);
      font-weight: bold;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      border-bottom: 3px solid var(--accent2);
      position: sticky;
      top: 0;
      z-index: 1;
    }
    table.workout-table td {
      background: var(--card-bg);
    }
    table.workout-table tr:last-child td {
      border-bottom: none;
    }
    .delete-btn {
      background: var(--accent4);
      color: var(--text);
      border: none;
      border-radius: 6px;
      padding: 0.5em 1em;
      min-width: 44px;
      min-height: 44px;
      cursor: pointer;
      font-size: 1em;
      font-weight: bold;
      transition: background 0.2s;
      outline: none;
      margin: 0;
    }
    .delete-btn:focus {
      outline: var(--focus-outline);
      background: var(--error);
      box-shadow: var(--focus-shadow);
    }
    .delete-btn:hover, .delete-btn:active {
      background: #a30b48;
    }
    /* Workout Form */
    .workout-form-section {
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 1.5em 1em;
      margin-bottom: 2em;
    }
    form#workout-form {
      display: flex;
      flex-direction: column;
      gap: 1.2em;
    }
    fieldset {
      border: 2px solid var(--input-border);
      border-radius: 8px;
      padding: 1em;
      margin: 0;
      background: var(--input-bg);
      color: var(--input-text);
      box-shadow: var(--shadow);
    }
    legend {
      color: var(--accent1);
      font-size: 1.1em;
      font-weight: bold;
      padding: 0 0.5em;
    }
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1em;
      align-items: flex-end;
    }
    .form-group {
      display: flex;
      flex-direction: column;
      flex: 1 1 180px;
      min-width: 180px;
      max-width: 300px;
      position: relative;
    }
    label {
      font-weight: 600;
      color: var(--accent2);
      margin-bottom: 0.2em;
      font-size: 1em;
      letter-spacing: 0.01em;
    }
    .required-indicator {
      color: var(--accent4);
      margin-left: 0.2em;
      font-size: 1.1em;
      vertical-align: middle;
    }
    input[type="text"], input[type="number"], input[type="date"], select {
      font-size: 1.1em;
      padding: 0.6em 0.9em;
      border: 2px solid var(--input-border);
      border-radius: 6px;
      background: var(--input-bg);
      color: var(--input-text);
      outline: none;
      min-width: 44px;
      min-height: 44px;
      box-shadow: var(--shadow);
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    input[type="text"]:focus, input[type="number"]:focus, input[type="date"]:focus, select:focus {
      border-color: var(--input-focus);
      box-shadow: var(--focus-shadow);
      outline: var(--focus-outline);
    }
    input[aria-invalid="true"], select[aria-invalid="true"] {
      border-color: var(--error);
      background: #ffe6ef;
      color: var(--error);
    }
    .error-message {
      color: var(--error);
      font-size: 1em;
      margin-top: 0.2em;
      margin-bottom: 0.3em;
      display: block;
      min-height: 1.3em;
    }
    .success-message {
      color: var(--success);
      font-size: 1em;
      margin-top: 0.2em;
      margin-bottom: 0.3em;
      display: block;
      min-height: 1.3em;
    }
    .help-text {
      color: var(--help-text);
      background: var(--help-bg);
      border-radius: 6px;
      font-size: 0.98em;
      padding: 0.3em 0.7em;
      margin-top: 0.2em;
      margin-bottom: 0.2em;
      display: inline-block;
    }
    .form-actions {
      display: flex;
      gap: 1em;
      margin-top: 1em;
      align-items: center;
    }
    .submit-btn {
      background: var(--button-bg);
      color: var(--button-text);
      border: none;
      border-radius: 8px;
      font-size: 1.15em;
      font-weight: bold;
      padding: 0.75em 2em;
      min-width: 44px;
      min-height: 44px;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: background 0.2s, color 0.2s;
      outline: none;
    }
    .submit-btn:focus {
      outline: var(--focus-outline);
      background: var(--button-hover);
      color: var(--focus);
      box-shadow: var(--focus-shadow);
    }
    .submit-btn:hover, .submit-btn:active {
      background: var(--button-hover);
    }
    .reset-btn {
      background: var(--accent2);
      color: var(--primary-bg);
      border: none;
      border-radius: 8px;
      font-size: 1.1em;
      font-weight: bold;
      padding: 0.7em 1.7em;
      min-width: 44px;
      min-height: 44px;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: background 0.2s, color 0.2s;
      outline: none;
    }
    .reset-btn:focus {
      outline: var(--focus-outline);
      background: var(--accent1);
      color: var(--primary-bg);
      box-shadow: var(--focus-shadow);
    }
    .reset-btn:hover, .reset-btn:active {
      background: var(--accent1);
      color: var(--primary-bg);
    }
    /* Progress Chart */
    .progress-section {
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 1.5em 1em;
      margin-bottom: 2em;
    }
    .chart-container {
      width: 100%;
      max-width: 600px;
      margin: 0 auto 1em auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .progress-chart {
      width: 100%;
      max-width: 560px;
      height: 240px;
      display: block;
      background: var(--progress-bg);
      border-radius: 12px;
      box-shadow: var(--shadow);
      border: 2px solid var(--accent1);
      margin-bottom: 0.8em;
    }
    .chart-legend {
      display: flex;
      gap: 2em;
      justify-content: center;
      align-items: center;
      font-size: 1em;
      margin-bottom: 0.5em;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5em;
    }
    .legend-color {
      width: 1.5em;
      height: 1.5em;
      border-radius: 4px;
      display: inline-block;
      border: 2px solid var(--primary-bg);
      box-shadow: var(--shadow);
    }
    .legend-duration { background: var(--progress-bar); }
    .legend-calories { background: var(--progress-bar2); }
    .legend-exercises { background: var(--progress-bar3); }
    /* Chart description for screen readers */
    .chart-description {
      position: absolute;
      left: -9999px;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
    /* Responsive */
    @media (max-width: 900px) {
      main {
        flex-direction: column;
        gap: 1.5em;
        padding: 1em 0.5em;
      }
      .main-content, aside.sidebar {
        max-width: 100%;
        min-width: 0;
      }
    }
    @media (max-width: 600px) {
      header, main, aside.sidebar {
        padding: 1em 0.3em;
      }
      .brand-title {
        font-size: 1.3em;
      }
      .progress-chart {
        height: 160px;
      }
    }
    /* Focus indicators for all interactive elements */
    a:focus, button:focus, input:focus, select:focus, .nav-link:focus, .breadcrumb-link:focus, .delete-btn:focus, .submit-btn:focus, .reset-btn:focus {
      outline: var(--focus-outline);
      box-shadow: var(--focus-shadow);
      z-index: 10;
    }
    /* Enhanced target size for all interactive elements */
    a, button, input[type="submit"], input[type="reset"], .nav-link, .breadcrumb-link, .delete-btn, .submit-btn, .reset-btn {
      min-width: 44px;
      min-height: 44px;
      box-sizing: border-box;
    }
    /* Sitemap */
    .sitemap-section {
      background: var(--sitemap-bg);
      color: var(--sitemap-link);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 1.5em 1em;
      margin-bottom: 2em;
      font-size: 1em;
    }
    .sitemap-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 0.7em;
    }
    .sitemap-link {
      color: var(--sitemap-link);
      text-decoration: underline;
      background: none;
      border: none;
      font-size: 1em;
      cursor: pointer;
      min-width: 44px;
      min-height: 44px;
      border-radius: 4px;
      transition: background 0.2s, color 0.2s;
      outline: none;
      display: inline-block;
    }
    .sitemap-link:focus {
      outline: var(--focus-outline);
      background: var(--sitemap-link-hover);
      color: var(--primary-bg);
      box-shadow: var(--focus-shadow);
    }
    .sitemap-link:hover, .sitemap-link:active {
      background: var(--sitemap-link-hover);
      color: var(--primary-bg);
    }
    /* Color customizer */
    .color-customizer {
      margin: 1em 0 1.5em 0;
      display: flex;
      flex-direction: column;
      gap: 0.7em;
    }
    .color-row {
      display: flex;
      gap: 1em;
      align-items: center;
    }
    .color-label {
      font-size: 1em;
      color: var(--accent2);
      font-weight: 600;
    }
    .color-input {
      width: 44px;
      height: 44px;
      border: 2px solid var(--input-border);
      border-radius: 8px;
      background: var(--input-bg);
      cursor: pointer;
      outline: none;
      margin-right: 0.5em;
      transition: border-color 0.2s;
    }
    .color-input:focus {
      border-color: var(--input-focus);
      outline: var(--focus-outline);
      box-shadow: var(--focus-shadow);
    }
    /* Loading Spinner */
    .loading-spinner {
      border: 4px solid var(--progress-bg);
      border-top: 4px solid var(--accent1);
      border-radius: 50%;
      width: 48px;
      height: 48px;
      animation: spin 1.2s linear infinite;
      margin: 2em auto;
      display: block;
    }
    @media (prefers-reduced-motion: reduce) {
      .loading-spinner {
        animation: none;
      }
    }
    @keyframes spin {
      0% { transform: rotate(0deg);}
      100% { transform: rotate(360deg);}
    }
    /* Status messages */
    [role="status"], [role="alert"] {
      font-size: 1.05em;
      margin: 0.5em 0 1em 0;
      padding: 0.7em 1em;
      border-radius: 8px;
      background: var(--help-bg);
      color: var(--help-text);
      box-shadow: var(--shadow);
      min-height: 1.5em;
    }
    /* Help icon */
    .help-icon {
      display: inline-block;
      width: 1.4em;
      height: 1.4em;
      border-radius: 50%;
      background: var(--accent1);
      color: var(--primary-bg);
      text-align: center;
      line-height: 1.4em;
      font-size: 1em;
      font-weight: bold;
      margin-left: 0.3em;
      vertical-align: middle;
      cursor: pointer;
      border: 2px solid var(--accent2);
      transition: background 0.2s;
    }
    .help-icon:focus, .help-icon:hover {
      background: var(--accent2);
      color: var(--primary-bg);
      outline: var(--focus-outline);
      box-shadow: var(--focus-shadow);
    }
    /* Visually hidden (for accessibility) */
    .visually-hidden {
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0, 0, 0, 0) !important;
      white-space: nowrap !important;
      border: 0 !important;
    }
    /* Modal dialog */
    .modal-backdrop {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(27,27,50,0.85);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-dialog {
      background: var(--card-bg);
      color: var(--text);
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.32);
      max-width: 420px;
      width: 95vw;
      padding: 2em 1.2em;
      outline: none;
      position: relative;
    }
    .modal-close-btn {
      position: absolute;
      top: 1em;
      right: 1em;
      background: var(--accent4);
      color: var(--text);
      border: none;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      font-size: 1.4em;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
      outline: none;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-close-btn:focus {
      outline: var(--focus-outline);
      background: var(--error);
      box-shadow: var(--focus-shadow);
    }
    .modal-close-btn:hover, .modal-close-btn:active {
      background: #a30b48;
    }
    /* Animation controls */
    .motion-toggle-row {
      margin-top: 1em;
      display: flex;
      align-items: center;
      gap: 1em;
    }
    .motion-toggle-label {
      color: var(--accent2);
      font-size: 1em;
      font-weight: 600;
    }
    .motion-toggle {
      width: 44px;
      height: 44px;
      min-width: 44px;
      min-height: 44px;
      border: 2px solid var(--input-border);
      border-radius: 8px;
      background: var(--input-bg);
      cursor: pointer;
      outline: none;
      margin-right: 0.5em;
      transition: border-color 0.2s;
    }
    .motion-toggle:focus {
      border-color: var(--input-focus);
      outline: var(--focus-outline);
      box-shadow: var(--focus-shadow);
    }
    /* Footer */
    footer {
      background: var(--primary-bg-light);
      color: var(--text);
      text-align: center;
      padding: 2em 1em 2.5em 1em;
      border-top: 4px solid var(--accent1);
      font-size: 1em;
      margin-top: 2em;
    }
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 2em;
      margin: 1em 0 0.5em 0;
      flex-wrap: wrap;
    }
    .footer-link {
      color: var(--accent2);
      text-decoration: underline;
      font-size: 1em;
      min-width: 44px;
      min-height: 44px;
      border-radius: 4px;
      transition: background 0.2s, color 0.2s;
      outline: none;
      display: inline-block;
      padding: 0.25em 0.5em;
    }
    .footer-link:focus {
      outline: var(--focus-outline);
      background: var(--accent1);
      color: var(--primary-bg);
      box-shadow: var(--focus-shadow);
    }
    .footer-link:hover, .footer-link:active {
      background: var(--accent1);
      color: var(--primary-bg);
    }
    /* Error prevention modal styles */
    .modal-dialog .modal-content {
      margin-top: 1em;
      font-size: 1em;
      color: var(--accent2);
    }
    /* Ensure paragraph spacing and line height */
    p, ul, ol, dl {
      margin-bottom: 1.5em;
    }
    p {
      max-width: 80ch;
      line-height: 1.6;
      margin-top: 0;
    }
    /* Unjustified text */
    p, li, td, th {
      text-align: left;
    }
    /* 200% zoom, responsive */
    html {
      font-size: 100%;
    }
    @media (max-width: 400px) {
      html {
        font-size: 95%;
      }
    }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-link" id="skip-link">Skip to main content</a>
  <header>
    <div class="brand" aria-label="Fitness Tracker brand">
      <span class="brand-logo" aria-hidden="true">🏋️‍♂️</span>
      <span class="brand-title">Accessible Fitness Tracker</span>
    </div>
    <nav aria-label="Primary navigation" id="main-nav">
      <ul class="nav-list" role="menubar">
        <li>
          <a href="#main-content" class="nav-link active" aria-current="page" role="menuitem" tabindex="0">Log Workouts</a>
        </li>
        <li>
          <a href="#progress" class="nav-link" role="menuitem" tabindex="0">Progress Chart</a>
        </li>
        <li>
          <a href="#sitemap" class="nav-link" role="menuitem" tabindex="0">Sitemap</a>
        </li>
        <li>
          <a href="#help" class="nav-link" role="menuitem" tabindex="0">Help</a>
        </li>
      </ul>
    </nav>
    <nav aria-label="Breadcrumb" id="breadcrumb-nav">
      <ol class="breadcrumb-list">
        <li><a href="#main-content" class="breadcrumb-link" tabindex="0">Home</a></li>
        <li><span class="breadcrumb-current" aria-current="page">Log Workouts</span></li>
      </ol>
    </nav>
  </header>
  <main id="main-content" tabindex="-1">
    <section class="main-content" aria-labelledby="workout-log-section-heading">
      <h1 id="workout-log-section-heading">Log Your Daily Workouts</h1>
      <section class="workout-form-section" aria-labelledby="workout-form-heading">
        <h2 id="workout-form-heading">Add a New Workout</h2>
        <form id="workout-form" autocomplete="off" novalidate aria-describedby="form-help">
          <fieldset>
            <legend>Workout Details</legend>
            <div class="form-row">
              <div class="form-group">
                <label for="exercise-type">
                  Exercise Type
                  <span class="required-indicator" aria-hidden="true">*</span>
                </label>
                <select id="exercise-type" name="exerciseType" required aria-required="true"
                  aria-describedby="exercise-type-help exercise-type-error" autocomplete="off">
                  <option value="">Select type</option>
                  <option value="Cardio">Cardio</option>
                  <option value="Strength">Strength</option>
                  <option value="Flexibility">Flexibility</option>
                  <option value="Balance">Balance</option>
                  <option value="HIIT">HIIT (High-Intensity Interval Training)</option>
                  <option value="Other">Other</option>
                </select>
                <span id="exercise-type-help" class="help-text">Choose the main type of exercise performed.</span>
                <span id="exercise-type-error" class="error-message" aria-live="polite"></span>
              </div>
              <div class="form-group">
                <label for="exercise-desc">
                  Exercise Description
                  <span class="required-indicator" aria-hidden="true">*</span>
                </label>
                <input type="text" id="exercise-desc" name="exerciseDesc" required aria-required="true"
                  aria-describedby="exercise-desc-help exercise-desc-error"
                  maxlength="40" inputmode="text" pattern="^[\w\s\-]{2,40}$"
                  autocomplete="off" placeholder="e.g., Running, Push-ups">
                <span id="exercise-desc-help" class="help-text">
                  Briefly describe the exercise (max 40 characters).
                </span>
                <span id="exercise-desc-error" class="error-message" aria-live="polite"></span>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="exercise-duration">
                  Duration (minutes)
                  <span class="required-indicator" aria-hidden="true">*</span>
                </label>
                <input type="number" id="exercise-duration" name="exerciseDuration" required aria-required="true"
                  aria-describedby="exercise-duration-help exercise-duration-error"
                  min="1" max="300" step="1" inputmode="numeric" autocomplete="off"
                  placeholder="e.g., 30">
                <span id="exercise-duration-help" class="help-text">
                  Enter the workout duration in minutes (1–300).
                </span>
                <span id="exercise-duration-error" class="error-message" aria-live="polite"></span>
              </div>
              <div class="form-group">
                <label for="calories-burned">
                  Calories Burned
                  <span class="required-indicator" aria-hidden="true">*</span>
                </label>
                <input type="number" id="calories-burned" name="caloriesBurned" required aria-required="true"
                  aria-describedby="calories-burned-help calories-burned-error"
                  min="1" max="5000" step="1" inputmode="numeric" autocomplete="off"
                  placeholder="e.g., 250">
                <span id="calories-burned-help" class="help-text">
                  Enter calories burned (1–5000).
                </span>
                <span id="calories-burned-error" class="error-message" aria-live="polite"></span>
              </div>
              <div class="form-group">
                <label for="exercise-date">
                  Date
                  <span class="required-indicator" aria-hidden="true">*</span>
                </label>
                <input type="date" id="exercise-date" name="exerciseDate" required aria-required="true"
                  aria-describedby="exercise-date-help exercise-date-error"
                  autocomplete="off" max="">
                <span id="exercise-date-help" class="help-text">
                  Select the date of your workout.
                </span>
                <span id="exercise-date-error" class="error-message" aria-live="polite"></span>
              </div>
            </div>
          </fieldset>
          <div class="form-actions">
            <button type="submit" class="submit-btn" id="submit-workout" aria-label="Add workout entry">
              Add Workout
            </button>
            <button type="reset" class="reset-btn" id="reset-form" aria-label="Reset form fields">
              Reset
            </button>
            <button type="button" class="help-icon" aria-label="Open context-sensitive help" id="open-help-modal" tabindex="0">?</button>
          </div>
          <div id="form-help" class="help-text" aria-live="polite">
            All fields are required. Need help? Click the <span aria-hidden="true" class="help-icon" style="display:inline-block;vertical-align:middle;">?</span> icon.
          </div>
          <div id="form-status" role="status" aria-live="polite"></div>
        </form>
      </section>
      <section class="workout-log-section" aria-labelledby="workout-log-heading">
        <h2 id="workout-log-heading">Workout Log</h2>
        <div class="workout-table-container" tabindex="0" aria-label="Workout log table">
          <table class="workout-table" id="workout-table" aria-describedby="workout-table-desc">
            <caption class="visually-hidden" id="workout-table-desc">
              Table listing all logged workouts including exercise type, description, duration, calories burned, date, and delete option.
            </caption>
            <thead>
              <tr>
                <th scope="col">Date</th>
                <th scope="col">Type</th>
                <th scope="col">Description</th>
                <th scope="col">Duration<br>(min)</th>
                <th scope="col">Calories</th>
                <th scope="col">Delete</th>
              </tr>
            </thead>
            <tbody id="workout-table-body">
              <!-- Dynamic content -->
            </tbody>
          </table>
        </div>
        <div id="table-status" role="status" aria-live="polite"></div>
      </section>
      <section class="progress-section" aria-labelledby="progress-heading">
        <h2 id="progress-heading">Your Progress Chart</h2>
        <div class="chart-container">
          <canvas id="progress-chart" class="progress-chart" width="560" height="240"
            aria-describedby="progress-chart-desc" tabindex="0"></canvas>
          <div id="progress-chart-desc" class="chart-description">
            This chart visually displays your total workout duration, calories burned, and number of exercises per day for the last 7 days. Each colored bar represents a day, with blue for duration, green for calories, and orange for number of exercises.
          </div>
          <div class="chart-legend" aria-label="Chart legend">
            <div class="legend-item">
              <span class="legend-color legend-duration" aria-hidden="true"></span>
              <span>Duration (min)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color legend-calories" aria-hidden="true"></span>
              <span>Calories</span>
            </div>
            <div class="legend-item">
              <span class="legend-color legend-exercises" aria-hidden="true"></span>
              <span>Exercises</span>
            </div>
          </div>
        </div>
        <div id="chart-status" role="status" aria-live="polite"></div>
      </section>
    </section>
    <aside class="sidebar" aria-labelledby="sidebar-heading">
      <h2 id="sidebar-heading">Tools & Preferences</h2>
      <section aria-labelledby="color-customizer-heading">
        <h3 id="color-customizer-heading">Color Customizer</h3>
        <form class="color-customizer" aria-describedby="color-customizer-desc">
          <div id="color-customizer-desc" class="help-text">
            Select your preferred foreground and background colors. This will update the page instantly.
          </div>
          <div class="color-row">
            <label for="user-fg" class="color-label">Text color:</label>
            <input type="color" id="user-fg" class="color-input" name="user-fg" value="#ffffff" aria-label="Choose text color" autocomplete="off">
          </div>
          <div class="color-row">
            <label for="user-bg" class="color-label">Background color:</label>
            <input type="color" id="user-bg" class="color-input" name="user-bg" value="#1b1b32" aria-label="Choose background color" autocomplete="off">
          </div>
        </form>
      </section>
      <section aria-labelledby="motion-toggle-heading">
        <h3 id="motion-toggle-heading">Motion & Animation</h3>
        <div class="motion-toggle-row">
          <label for="motion-toggle" class="motion-toggle-label">Enable chart animation:</label>
          <input type="checkbox" id="motion-toggle" class="motion-toggle" checked aria-checked="true" aria-label="Toggle chart animation">
        </div>
        <div class="help-text" id="motion-toggle-help">
          If you prefer less motion, disable chart animation.
        </div>
      </section>
      <section aria-labelledby="sidebar-help-heading" id="help">
        <h3 id="sidebar-help-heading">Quick Help</h3>
        <ul>
          <li>Use the form to log your daily workouts.</li>
          <li>All fields are required. Errors will be announced and shown below each field.</li>
          <li>Use the <span class="help-icon" aria-hidden="true">?</span> button for detailed, context-sensitive help.</li>
          <li>Customize colors and animation using the tools above.</li>
          <li>Use keyboard navigation: Tab/Shift+Tab, Enter/Space to activate buttons, Esc to close dialogs.</li>
        </ul>
      </section>
    </aside>
  </main>
  <section class="sitemap-section" aria-labelledby="sitemap-heading" id="sitemap">
    <h2 id="sitemap-heading">Sitemap</h2>
    <ul class="sitemap-list">
      <li><a href="#main-content" class="sitemap-link">Log Workouts</a></li>
      <li><a href="#progress" class="sitemap-link">Progress Chart</a></li>
      <li><a href="#help" class="sitemap-link">Help</a></li>
      <li><a href="#color-customizer-heading" class="sitemap-link">Color Customizer</a></li>
      <li><a href="#motion-toggle-heading" class="sitemap-link">Motion & Animation</a></li>
    </ul>
  </section>
  <footer>
    <nav aria-label="Footer navigation">
      <div class="footer-links">
        <a href="#main-content" class="footer-link">Log Workouts</a>
        <a href="#progress" class="footer-link">Progress Chart</a>
        <a href="#sitemap" class="footer-link">Sitemap</a>
        <a href="#help" class="footer-link">Help</a>
      </div>
    </nav>
    <div>
      <strong>Accessible Fitness Tracker</strong> &mdash; Built to WCAG 2.2 AAA standards.
      <br>
      <span lang="es" aria-label="Spanish: Seguimiento de Fitness Accesible">Traducción: Seguimiento de Fitness Accesible</span>
    </div>
    <div style="margin-top:1em;">
      <small>
        <abbr title="World Wide Web Consortium">W3C</abbr> <abbr title="Web Content Accessibility Guidelines">WCAG</abbr> 2.2 AAA Compliant.
        <span aria-label="Pronunciation: Accessible">/əkˈsɛsəbəl/</span>
      </small>
    </div>
  </footer>
  <!-- Context-sensitive Help Modal (hidden by default) -->
  <div id="help-modal" class="modal-backdrop" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="help-modal-title" tabindex="-1">
    <div class="modal-dialog" tabindex="0">
      <button class="modal-close-btn" aria-label="Close help dialog" id="close-help-modal" type="button">&times;</button>
      <h2 id="help-modal-title">Context-Sensitive Help: Logging a Workout</h2>
      <div class="modal-content">
        <p>
          To log a workout, fill in all required fields:
        </p>
        <ul>
          <li><strong>Exercise Type:</strong> Select the main category of your exercise.</li>
          <li><strong>Exercise Description:</strong> Briefly describe the specific activity (e.g., Running, Push-ups).</li>
          <li><strong>Duration:</strong> Enter the total minutes spent (1–300).</li>
          <li><strong>Calories Burned:</strong> Enter the estimated calories burned (1–5000).</li>
          <li><strong>Date:</strong> Choose the workout date. You can't select a future date.</li>
        </ul>
        <p>
          After submitting, your workout will appear in the log below and update your progress chart.
        </p>
        <p>
          <strong>Accessibility:</strong> All fields have labels, help text, and error messages. Use Tab/Shift+Tab to navigate, Enter/Space to activate buttons, and Esc to close this help dialog.
        </p>
      </div>
    </div>
  </div>
  <!-- Error prevention modal (hidden by default) -->
  <div id="error-prevention-modal" class="modal-backdrop" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="error-prevention-title" tabindex="-1">
    <div class="modal-dialog" tabindex="0">
      <button class="modal-close-btn" aria-label="Close error prevention dialog" id="close-error-prevention-modal" type="button">&times;</button>
      <h2 id="error-prevention-title">Confirm Deletion</h2>
      <div class="modal-content" id="error-prevention-content">
        <!-- Dynamic content -->
      </div>
      <div style="margin-top:1em; display:flex; gap:1em; justify-content:flex-end;">
        <button type="button" class="submit-btn" id="confirm-delete-btn">Yes, Delete</button>
        <button type="button" class="reset-btn" id="cancel-delete-btn">Cancel</button>
      </div>
    </div>
  </div>
  <script>
    // Accessibility: Set max date for workout date to today
    document.getElementById('exercise-date').max = new Date().toISOString().split('T')[0];

    // Utility: Focus trap for modal dialogs
    function trapFocus(modal) {
      const focusableSelectors = 'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';
      const focusableEls = Array.from(modal.querySelectorAll(focusableSelectors)).filter(el => !el.disabled && el.offsetParent !== null);
      if (focusableEls.length === 0) return;
      let firstEl = focusableEls[0], lastEl = focusableEls[focusableEls.length - 1];
      modal.addEventListener('keydown', function(e) {
        if (e.key === 'Tab') {
          if (e.shiftKey) {
            if (document.activeElement === firstEl) {
              e.preventDefault();
              lastEl.focus();
            }
          } else {
            if (document.activeElement === lastEl) {
              e.preventDefault();
              firstEl.focus();
            }
          }
        } else if (e.key === 'Escape') {
          if (modal.id === 'help-modal') closeHelpModal();
          if (modal.id === 'error-prevention-modal') closeErrorPreventionModal();
        }
      });
    }

    // Modal: Context-sensitive help
    const helpModal = document.getElementById('help-modal');
    const openHelpBtn = document.getElementById('open-help-modal');
    const closeHelpBtn = document.getElementById('close-help-modal');
    openHelpBtn.addEventListener('click', openHelpModal);
    openHelpBtn.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        openHelpModal();
      }
    });
    closeHelpBtn.addEventListener('click', closeHelpModal);

    function openHelpModal() {
      helpModal.style.display = 'flex';
      helpModal.setAttribute('aria-hidden', 'false');
      setTimeout(() => {
        helpModal.querySelector('.modal-dialog').focus();
      }, 100);
      trapFocus(helpModal);
    }
    function closeHelpModal() {
      helpModal.style.display = 'none';
      helpModal.setAttribute('aria-hidden', 'true');
      openHelpBtn.focus();
    }
    helpModal.addEventListener('click', function(e) {
      if (e.target === helpModal) closeHelpModal();
    });

    // Modal: Error prevention (delete confirmation)
    const errorPreventionModal = document.getElementById('error-prevention-modal');
    const closeErrorPreventionBtn = document.getElementById('close-error-prevention-modal');
    const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
    const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
    let deleteRowId = null;
    closeErrorPreventionBtn.addEventListener('click', closeErrorPreventionModal);
    cancelDeleteBtn.addEventListener('click', closeErrorPreventionModal);
    errorPreventionModal.addEventListener('click', function(e) {
      if (e.target === errorPreventionModal) closeErrorPreventionModal();
    });
    function openErrorPreventionModal(rowId, desc) {
      deleteRowId = rowId;
      document.getElementById('error-prevention-content').innerHTML =
        `<p>Are you sure you want to delete the workout entry for <strong>${desc}</strong>? This action cannot be undone.</p>`;
      errorPreventionModal.style.display = 'flex';
      errorPreventionModal.setAttribute('aria-hidden', 'false');
      setTimeout(() => {
        errorPreventionModal.querySelector('.modal-dialog').focus();
      }, 100);
      trapFocus(errorPreventionModal);
    }
    function closeErrorPreventionModal() {
      errorPreventionModal.style.display = 'none';
      errorPreventionModal.setAttribute('aria-hidden', 'true');
      deleteRowId = null;
    }
    confirmDeleteBtn.addEventListener('click', function() {
      if (deleteRowId !== null) {
        deleteWorkoutRow(deleteRowId);
        closeErrorPreventionModal();
      }
    });

    // Focus management for skip link
    document.getElementById('skip-link').addEventListener('click', function() {
      document.getElementById('main-content').focus();
    });

    // Keyboard navigation for nav links (simulate button behavior)
    document.querySelectorAll('.nav-link').forEach(function(link) {
      link.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          link.click();
        }
      });
    });

    // Keyboard navigation for sitemap links
    document.querySelectorAll('.sitemap-link').forEach(function(link) {
      link.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          link.click();
        }
      });
    });

    // Keyboard navigation for breadcrumb links
    document.querySelectorAll('.breadcrumb-link').forEach(function(link) {
      link.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          link.click();
        }
      });
    });

    // Enhanced color customizer (user-selectable foreground/background)
    function setUserColors(fg, bg) {
      document.documentElement.style.setProperty('--user-fg', fg);
      document.documentElement.style.setProperty('--user-bg', bg);
    }
    const fgInput = document.getElementById('user-fg');
    const bgInput = document.getElementById('user-bg');
    fgInput.addEventListener('input', function() {
      setUserColors(fgInput.value, bgInput.value);
    });
    bgInput.addEventListener('input', function() {
      setUserColors(fgInput.value, bgInput.value);
    });

    // Animation/motion toggle
    let enableChartAnimation = true;
    const motionToggle = document.getElementById('motion-toggle');
    motionToggle.checked = true;
    motionToggle.setAttribute('aria-checked', 'true');
    motionToggle.addEventListener('change', function() {
      enableChartAnimation = motionToggle.checked;
      motionToggle.setAttribute('aria-checked', enableChartAnimation ? 'true' : 'false');
      drawProgressChart();
    });

    // Respect prefers-reduced-motion
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      enableChartAnimation = false;
      motionToggle.checked = false;
      motionToggle.setAttribute('aria-checked', 'false');
    }

    // Workout data management (localStorage for persistence)
    let workouts = [];
    let workoutIdCounter = 0;
    function loadWorkouts() {
      try {
        const data = JSON.parse(localStorage.getItem('accessibleFitnessWorkouts'));
        if (Array.isArray(data)) {
          workouts = data;
          workoutIdCounter = Math.max(0, ...workouts.map(w => w.id || 0)) + 1;
        }
      } catch (e) { workouts = []; }
    }
    function saveWorkouts() {
      localStorage.setItem('accessibleFitnessWorkouts', JSON.stringify(workouts));
    }

    // Render workout log table
    function renderWorkoutTable() {
      const tbody = document.getElementById('workout-table-body');
      tbody.innerHTML = '';
      if (workouts.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6" style="text-align:center;color:var(--accent2);">No workouts logged yet.</td></tr>`;
        document.getElementById('table-status').textContent = "No workouts logged yet.";
        return;
      }
      workouts
        .sort((a, b) => b.date.localeCompare(a.date) || b.id - a.id)
        .forEach(workout => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${workout.date}</td>
            <td>${workout.type}</td>
            <td>${workout.desc}</td>
            <td>${workout.duration}</td>
            <td>${workout.calories}</td>
            <td>
              <button type="button" class="delete-btn" aria-label="Delete workout for ${workout.desc} on ${workout.date}" data-id="${workout.id}">Delete</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      document.getElementById('table-status').textContent = workouts.length + " workout(s) logged.";
    }
    // Delete workout row (with confirmation)
    function deleteWorkoutRow(rowId) {
      workouts = workouts.filter(w => w.id !== rowId);
      saveWorkouts();
      renderWorkoutTable();
      drawProgressChart();
      document.getElementById('table-status').textContent = "Workout deleted.";
    }
    // Attach delete handlers (using event delegation)
    document.getElementById('workout-table-body').addEventListener('click', function(e) {
      if (e.target && e.target.classList.contains('delete-btn')) {
        const rowId = parseInt(e.target.getAttribute('data-id'), 10);
        const workout = workouts.find(w => w.id === rowId);
        if (workout) {
          openErrorPreventionModal(rowId, `${workout.desc} (${workout.date})`);
        }
      }
    });

    // Form validation and error handling (AAA)
    const form = document.getElementById('workout-form');
    const formStatus = document.getElementById('form-status');
    function clearErrors() {
      ['exercise-type','exercise-desc','exercise-duration','calories-burned','exercise-date'].forEach(id => {
        document.getElementById(id).setAttribute('aria-invalid', 'false');
        document.getElementById(id+'-error').textContent = '';
      });
      formStatus.textContent = '';
    }
    function showError(id, message) {
      document.getElementById(id).setAttribute('aria-invalid', 'true');
      document.getElementById(id+'-error').textContent = message;
      document.getElementById(id).focus();
    }
    function showSuccess(message) {
      formStatus.innerHTML = `<span class="success-message">${message}</span>`;
    }
    function showFormError(message) {
      formStatus.innerHTML = `<span class="error-message">${message}</span>`;
    }
    function validateForm() {
      clearErrors();
      let valid = true;
      // Exercise type
      const type = form['exerciseType'].value.trim();
      if (!type) {
        showError('exercise-type', 'Please select an exercise type.');
        valid = false;
      }
      // Exercise desc
      const desc = form['exerciseDesc'].value.trim();
      if (!desc) {
        showError('exercise-desc', 'Please enter a description.');
        valid = false;
      } else if (!/^[\w\s\-]{2,40}$/.test(desc)) {
        showError('exercise-desc', 'Description must be 2–40 letters, numbers, spaces or dashes.');
        valid = false;
      }
      // Duration
      const duration = form['exerciseDuration'].value.trim();
      if (!duration) {
        showError('exercise-duration', 'Please enter duration.');
        valid = false;
      } else if (isNaN(duration) || duration < 1 || duration > 300) {
        showError('exercise-duration', 'Duration must be 1–300 minutes.');
        valid = false;
      }
      // Calories
      const calories = form['caloriesBurned'].value.trim();
      if (!calories) {
        showError('calories-burned', 'Please enter calories burned.');
        valid = false;
      } else if (isNaN(calories) || calories < 1 || calories > 5000) {
        showError('calories-burned', 'Calories must be 1–5000.');
        valid = false;
      }
      // Date
      const date = form['exerciseDate'].value.trim();
      const today = new Date().toISOString().split('T')[0];
      if (!date) {
        showError('exercise-date', 'Please select a date.');
        valid = false;
      } else if (date > today) {
        showError('exercise-date', 'Date cannot be in the future.');
        valid = false;
      }
      return valid;
    }
    // Prevent repeated data entry: prefill with last values if available
    function prefillForm() {
      if (workouts.length > 0) {
        const last = workouts[workouts.length - 1];
        form['exerciseType'].value = last.type;
        form['exerciseDesc'].value = '';
        form['exerciseDuration'].value = '';
        form['caloriesBurned'].value = '';
        form['exerciseDate'].value = new Date().toISOString().split('T')[0];
      }
    }
    // Form submit handler
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      clearErrors();
      if (!validateForm()) {
        showFormError('Please correct the highlighted errors.');
        return;
      }
      // Error prevention: Confirm before overwriting same day, same type
      const type = form['exerciseType'].value.trim();
      const desc = form['exerciseDesc'].value.trim();
      const duration = parseInt(form['exerciseDuration'].value.trim(), 10);
      const calories = parseInt(form['caloriesBurned'].value.trim(), 10);
      const date = form['exerciseDate'].value.trim();
      const duplicate = workouts.find(w => w.type === type && w.date === date && w.desc === desc);
      if (duplicate) {
        showFormError('You already logged this exercise for this date.');
        document.getElementById('exercise-desc').focus();
        return;
      }
      const workout = {
        id: workoutIdCounter++,
        type, desc, duration, calories, date
      };
      workouts.push(workout);
      saveWorkouts();
      renderWorkoutTable();
      drawProgressChart();
      showSuccess('Workout added successfully!');
      form.reset();
      prefillForm();
    });
    // Form reset: clear errors, prefill date
    form.addEventListener('reset', function(e) {
      setTimeout(() => {
        clearErrors();
        prefillForm();
      }, 10);
    });
    // Error prevention for accidental navigation
    let formDirty = false;
    form.addEventListener('input', function() { formDirty = true; });
    window.addEventListener('beforeunload', function(e) {
      if (formDirty) {
        e.preventDefault();
        e.returnValue = '';
      }
    });

    // Progress chart (Canvas, accessible)
    const chartCanvas = document.getElementById('progress-chart');
    let chartAnimationFrame = null;
    function getLast7Days() {
      const today = new Date();
      const days = [];
      for (let i = 6; i >= 0; i--) {
        const d = new Date(today);
        d.setDate(today.getDate() - i);
        days.push(d.toISOString().split('T')[0]);
      }
      return days;
    }
    function getChartData() {
      const days = getLast7Days();
      const chartData = days.map(date => {
        const dayWorkouts = workouts.filter(w => w.date === date);
        return {
          date,
          duration: dayWorkouts.reduce((sum, w) => sum + w.duration, 0),
          calories: dayWorkouts.reduce((sum, w) => sum + w.calories, 0),
          count: dayWorkouts.length
        };
      });
      return chartData;
    }
    function drawProgressChart() {
      if (!chartCanvas) return;
      const ctx = chartCanvas.getContext('2d');
      ctx.clearRect(0, 0, chartCanvas.width, chartCanvas.height);
      const chartData = getChartData();
      // Chart dimensions
      const padding = 48;
      const barWidth = 18;
      const gap = 32;
      const x0 = padding;
      const y0 = chartCanvas.height - padding;
      // Find max for scaling
      const maxDuration = Math.max(60, ...chartData.map(d => d.duration));
      const maxCalories = Math.max(200, ...chartData.map(d => d.calories));
      const maxCount = Math.max(2, ...chartData.map(d => d.count));
      // Axis
      ctx.save();
      ctx.strokeStyle = '#b0cfff';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(x0, y0);
      ctx.lineTo(chartCanvas.width - padding, y0);
      ctx.moveTo(x0, y0);
      ctx.lineTo(x0, padding);
      ctx.stroke();
      ctx.restore();
      // Draw bars
      let animationProgress = enableChartAnimation ? 0 : 1;
      let startTime = null;
      function animateChart(ts) {
        if (!enableChartAnimation) animationProgress = 1;
        else if (!startTime) startTime = ts;
        if (enableChartAnimation) {
          animationProgress = Math.min(1, (ts - startTime) / 600);
        }
        ctx.clearRect(0, 0, chartCanvas.width, chartCanvas.height);
        // Redraw axes
        ctx.save();
        ctx.strokeStyle = '#b0cfff';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(x0, y0);
        ctx.lineTo(chartCanvas.width - padding, y0);
        ctx.moveTo(x0, y0);
        ctx.lineTo(x0, padding);
        ctx.stroke();
        ctx.restore();
        // Draw bars for each day
        for (let i = 0; i < chartData.length; i++) {
          const x = x0 + i * gap * 2;
          // Duration (blue)
          const h1 = Math.round(animationProgress * (chartData[i].duration / maxDuration) * (y0 - padding - 24));
          ctx.fillStyle = 'var(--progress-bar)';
          ctx.fillRect(x + 0, y0 - h1, barWidth, h1);
          // Calories (green)
          const h2 = Math.round(animationProgress * (chartData[i].calories / maxCalories) * (y0 - padding - 24));
          ctx.fillStyle = 'var(--progress-bar2)';
          ctx.fillRect(x + barWidth + 4, y0 - h2, barWidth, h2);
          // Count (orange)
          const h3 = Math.round(animationProgress * (chartData[i].count / maxCount) * (y0 - padding - 24));
          ctx.fillStyle = 'var(--progress-bar3)';
          ctx.fillRect(x + 2 * (barWidth + 4), y0 - h3, barWidth, h3);
          // Day label
          ctx.save();
          ctx.font = 'bold 1em Segoe UI, Arial, sans-serif';
          ctx.fillStyle = 'var(--accent2)';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'top';
          const dateLabel = chartData[i].date.slice(5);
          ctx.fillText(dateLabel, x + barWidth + 6, y0 + 6);
          ctx.restore();
        }
        // Y-axis labels
        ctx.save();
        ctx.font = '1em Segoe UI, Arial, sans-serif';
        ctx.fillStyle = 'var(--accent1)';
        ctx.textAlign = 'right';
        ctx.textBaseline = 'middle';
        ctx.fillText(maxDuration + ' min', x0 - 6, padding + 8);
        ctx.fillText(maxCalories + ' cal', x0 - 6, padding + 28);
        ctx.fillText(maxCount + ' ex', x0 - 6, padding + 48);
        ctx.restore();
        // Animate or finish
        if (enableChartAnimation && animationProgress < 1) {
          chartAnimationFrame = requestAnimationFrame(animateChart);
        }
      }
      if (chartAnimationFrame) cancelAnimationFrame(chartAnimationFrame);
      chartAnimationFrame = requestAnimationFrame(animateChart);
      // Accessible chart description (update)
      let chartDesc = "Progress chart for the last 7 days. ";
      chartData.forEach(d => {
        chartDesc += `On ${d.date}, duration: ${d.duration} min, calories: ${d.calories}, exercises: ${d.count}. `;
      });
      document.getElementById('chart-status').textContent = chartDesc;
    }

    // Initial load
    loadWorkouts();
    renderWorkoutTable();
    drawProgressChart();
    prefillForm();

    // Ensure focus indicators always visible
    document.addEventListener('focusin', function(e) {
      if (e.target.matches('a, button, input, select, .nav-link, .breadcrumb-link, .delete-btn, .submit-btn, .reset-btn, .color-input, .motion-toggle')) {
        e.target.style.zIndex = 10;
      }
    });

    // Touch/pointer support: pointer cancellation (up-event completion)
    document.querySelectorAll('button, .nav-link, .sitemap-link, .breadcrumb-link').forEach(el => {
      el.addEventListener('pointerdown', function(e) {
        if (e.pointerType === 'touch') {
          e.preventDefault();
        }
      });
    });

    // Drag alternatives not needed as no drag UI

    // Responsive zoom test (simulate 200% zoom)
    window.addEventListener('resize', function() {
      // No horizontal scroll at 200% font-size
      document.body.style.overflowX = 'hidden';
    });

    // Enhanced authentication: No cognitive test, redundant entry minimized

    // Abbreviation/definition examples
    // (in footer: W3C, WCAG, pronunciation, language change for Spanish)

    // Provide alternative access to submenu items: sitemap

    // Status messages via aria-live
    // (form-status, table-status, chart-status)

    // Reduced motion for chart if prefers-reduced-motion
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      enableChartAnimation = false;
      motionToggle.checked = false;
      motionToggle.setAttribute('aria-checked', 'false');
    }
  </script>
</body>
</html>